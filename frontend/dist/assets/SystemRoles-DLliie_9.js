import{A as e,C as t,N as n,O as r,_ as i,c as a,d as o,f as s,g as c,h as l,i as u,j as d,l as f,m as p,p as m,s as h,w as g,x as _,y as v}from"./index-D-ACJEW6.js";var y={name:`SystemRoles`,setup(){let t=e([]),n=e(null),r=e(!1),i=e(!1),a=e({name:``,description:``,protected:!1,initialPermissionSet:`none`}),o=e([{id:1,name:`用户管理`,permissions:[{id:101,name:`查看用户`,code:`VIEW_USER`,description:`查看系统用户信息`},{id:102,name:`创建用户`,code:`CREATE_USER`,description:`创建新用户账号`},{id:103,name:`编辑用户`,code:`EDIT_USER`,description:`编辑现有用户信息`},{id:104,name:`删除用户`,code:`DELETE_USER`,description:`删除用户账号`},{id:105,name:`导入用户`,code:`IMPORT_USER`,description:`批量导入用户数据`},{id:106,name:`导出用户`,code:`EXPORT_USER`,description:`导出用户数据列表`}]},{id:2,name:`课程管理`,permissions:[{id:201,name:`查看课程`,code:`VIEW_COURSE`,description:`查看课程信息`},{id:202,name:`创建课程`,code:`CREATE_COURSE`,description:`创建新课程`},{id:203,name:`编辑课程`,code:`EDIT_COURSE`,description:`编辑课程信息`},{id:204,name:`删除课程`,code:`DELETE_COURSE`,description:`删除课程`},{id:205,name:`发布课程`,code:`PUBLISH_COURSE`,description:`发布课程供学生选修`}]},{id:3,name:`排课管理`,permissions:[{id:301,name:`查看排课`,code:`VIEW_SCHEDULE`,description:`查看课程安排`},{id:302,name:`创建排课`,code:`CREATE_SCHEDULE`,description:`创建课程安排`},{id:303,name:`编辑排课`,code:`EDIT_SCHEDULE`,description:`编辑课程安排`},{id:304,name:`删除排课`,code:`DELETE_SCHEDULE`,description:`删除课程安排`},{id:305,name:`导出课表`,code:`EXPORT_SCHEDULE`,description:`导出课程表`}]},{id:4,name:`成绩管理`,permissions:[{id:401,name:`查看成绩`,code:`VIEW_SCORE`,description:`查看学生成绩`},{id:402,name:`更新成绩`,code:`UPDATE_SCORE`,description:`更新学生成绩`},{id:403,name:`导入成绩`,code:`IMPORT_SCORE`,description:`批量导入成绩`},{id:404,name:`导出成绩`,code:`EXPORT_SCORE`,description:`导出成绩报表`},{id:405,name:`成绩统计`,code:`STATISTIC_SCORE`,description:`统计分析成绩数据`}]},{id:5,name:`系统管理`,permissions:[{id:501,name:`系统配置`,code:`SYSTEM_CONFIG`,description:`修改系统配置参数`},{id:502,name:`数据备份`,code:`DATA_BACKUP`,description:`执行数据备份操作`},{id:503,name:`数据恢复`,code:`DATA_RESTORE`,description:`执行数据恢复操作`},{id:504,name:`查看日志`,code:`VIEW_LOGS`,description:`查看系统操作日志`},{id:505,name:`管理角色`,code:`MANAGE_ROLES`,description:`管理系统角色`},{id:506,name:`管理权限`,code:`MANAGE_PERMISSIONS`,description:`管理权限分配`},{id:507,name:`系统监控`,code:`SYSTEM_MONITOR`,description:`监控系统运行状态`}]}]),s={none:[],student:[`VIEW_COURSE`,`VIEW_SCHEDULE`,`VIEW_SCORE`],teacher:[`VIEW_COURSE`,`CREATE_COURSE`,`EDIT_COURSE`,`VIEW_SCHEDULE`,`CREATE_SCHEDULE`,`EDIT_SCHEDULE`,`DELETE_SCHEDULE`,`VIEW_SCORE`,`UPDATE_SCORE`],admin:[`VIEW_USER`,`CREATE_USER`,`EDIT_USER`,`VIEW_COURSE`,`CREATE_COURSE`,`EDIT_COURSE`,`DELETE_COURSE`,`VIEW_SCHEDULE`,`CREATE_SCHEDULE`,`EDIT_SCHEDULE`,`DELETE_SCHEDULE`,`VIEW_LOGS`],superAdmin:`VIEW_USER.CREATE_USER.EDIT_USER.DELETE_USER.IMPORT_USER.EXPORT_USER.VIEW_COURSE.CREATE_COURSE.EDIT_COURSE.DELETE_COURSE.PUBLISH_COURSE.VIEW_SCHEDULE.CREATE_SCHEDULE.EDIT_SCHEDULE.DELETE_SCHEDULE.EXPORT_SCHEDULE.VIEW_SCORE.UPDATE_SCORE.IMPORT_SCORE.EXPORT_SCORE.STATISTIC_SCORE.SYSTEM_CONFIG.DATA_BACKUP.DATA_RESTORE.VIEW_LOGS.MANAGE_ROLES.MANAGE_PERMISSIONS.SYSTEM_MONITOR`.split(`.`)},c=()=>{u.adminData&&u.adminData.roles?t.value=u.adminData.roles.map(e=>({...e,permissions:e.permissions||s[e.name===`超级管理员`?`superAdmin`:e.name===`系统管理员`?`admin`:e.name===`教师`?`teacher`:`student`],userCount:Math.floor(Math.random()*50)+1})):t.value=[{id:1,name:`超级管理员`,description:`系统最高权限，可管理所有功能`,protected:!0,permissions:s.superAdmin,userCount:1},{id:2,name:`系统管理员`,description:`系统管理权限，可管理用户、课程等`,protected:!1,permissions:s.admin,userCount:4},{id:3,name:`教师`,description:`教学相关权限，管理课程和学生`,protected:!1,permissions:s.teacher,userCount:25},{id:4,name:`学生`,description:`学习相关权限，查看课程和成绩`,protected:!1,permissions:s.student,userCount:120}],t.value.length>0&&(n.value=t.value[0].id)},l=p(()=>t.value.find(e=>e.id===n.value)||null),d=p(()=>l.value?o.value.flatMap(e=>e.permissions.map(e=>e.code)).every(e=>l.value.permissions.includes(e)):!1),f=e=>{n.value=e},m=e=>{if(!l.value)return!1;let t=o.value.find(t=>t.id===e);return t?t.permissions.every(e=>l.value.permissions.includes(e.code)):!1},h=e=>{if(!l.value)return!1;let t=o.value.find(t=>t.id===e);if(!t)return!1;let n=t.permissions.filter(e=>l.value.permissions.includes(e.code)).length;return n>0&&n<t.permissions.length},g=e=>{if(!l.value)return;let t=o.value.find(t=>t.id===e);if(!t)return;let n=m(e);t.permissions.forEach(e=>{let t=l.value.permissions.indexOf(e.code);n&&t!==-1?l.value.permissions.splice(t,1):!n&&t===-1&&l.value.permissions.push(e.code)})},v=()=>{if(l.value)if(d.value)l.value.permissions=[];else{let e=o.value.flatMap(e=>e.permissions.map(e=>e.code));l.value.permissions=[...e]}},y=()=>{l.value&&alert(`角色 ${l.value.name} 的权限配置已保存`)},b=e=>{a.value={id:e.id,name:e.name,description:e.description,protected:e.protected,initialPermissionSet:`none`},i.value=!0},x=()=>{r.value=!1,i.value=!1,a.value={name:``,description:``,protected:!1,initialPermissionSet:`none`}};return _(()=>{c(),u.role!==`superAdmin`&&alert(`权限不足，请联系超级管理员`)}),{roles:t,selectedRoleId:n,selectedRole:l,permissionCategories:o,allPermissionsSelected:d,showAddRoleDialog:r,showEditRoleDialog:i,roleForm:a,selectRole:f,isCategoryChecked:m,isCategoryIndeterminate:h,toggleCategory:g,toggleAllPermissions:v,saveRolePermissions:y,editRole:b,closeRoleDialog:x,saveRole:()=>{if(i.value){let e=t.value.findIndex(e=>e.id===a.value.id);e!==-1&&(t.value[e]={...t.value[e],name:a.value.name,description:a.value.description,protected:a.value.protected},alert(`角色更新成功`))}else{let e={id:t.value.length+1,name:a.value.name,description:a.value.description,protected:a.value.protected,permissions:s[a.value.initialPermissionSet]||[],userCount:0};t.value.push(e),alert(`角色添加成功`),n.value=e.id}x()},deleteRole:e=>{let r=t.value.find(t=>t.id===e);if(r.userCount>0){alert(`无法删除角色 ${r.name}，该角色下还有 ${r.userCount} 个用户`);return}confirm(`确定要删除角色 ${r.name} 吗？此操作不可恢复！`)&&(t.value=t.value.filter(t=>t.id!==e),alert(`角色删除成功`),n.value===e&&t.value.length>0?n.value=t.value[0].id:t.value.length===0&&(n.value=null))},exportRoles:()=>{alert(`角色配置已导出`)}}}},b={class:`system-roles`},x={class:`page-header`},S={class:`header-actions`},C={class:`roles-section`},w={class:`roles-grid`},T=[`onClick`],E={class:`role-header`},D={class:`role-name`},O={key:0,class:`protected-badge`},k={class:`role-description`},A={class:`role-stats`},j={class:`role-actions`},M=[`onClick`],N=[`onClick`],P={key:0,class:`permissions-section`},F={class:`permission-actions`},I={class:`permission-tree`},L={class:`category-header`},ee=[`id`,`checked`,`indeterminate`,`onChange`],R=[`for`],z={class:`category-permissions`},B=[`id`,`value`],V=[`for`],H={class:`permission-name`},U={class:`permission-description`},W={class:`dialog-header`},G={class:`dialog-body`},K={class:`form-group`},q={class:`form-group`},J={class:`form-group`},Y={class:`form-group`},X={class:`initial-permissions`},Z={class:`dialog-footer`};function Q(e,u,p,h,_,y){return t(),i(`div`,b,[l(`div`,x,[u[18]||=l(`h2`,null,`角色与权限管理`,-1),l(`div`,S,[l(`button`,{class:`action-button primary`,onClick:u[0]||=e=>h.showAddRoleDialog=!0},`添加角色`),l(`button`,{class:`action-button`,onClick:u[1]||=(...e)=>h.exportRoles&&h.exportRoles(...e)},`导出角色配置`)])]),l(`div`,C,[u[19]||=l(`h3`,null,`系统角色`,-1),l(`div`,w,[(t(!0),i(m,null,g(h.roles,e=>(t(),i(`div`,{key:e.id,class:d([`role-card`,{selected:h.selectedRoleId===e.id}]),onClick:t=>h.selectRole(e.id)},[l(`div`,E,[l(`div`,D,n(e.name),1),e.protected?(t(),i(`div`,O,`受保护`)):c(``,!0)]),l(`div`,k,n(e.description),1),l(`div`,A,[l(`span`,null,`权限数: `+n(e.permissions.length),1),l(`span`,null,`用户数: `+n(e.userCount),1)]),l(`div`,j,[l(`button`,{class:`mini-button`,onClick:s(t=>h.editRole(e),[`stop`])},`编辑`,8,M),e.protected?c(``,!0):(t(),i(`button`,{key:0,class:`mini-button delete`,onClick:s(t=>h.deleteRole(e.id),[`stop`])},` 删除 `,8,N))])],10,T))),128))])]),h.selectedRole?(t(),i(`div`,P,[l(`h3`,null,`权限配置 - `+n(h.selectedRole.name),1),l(`div`,F,[l(`button`,{class:`action-button`,onClick:u[2]||=(...e)=>h.toggleAllPermissions&&h.toggleAllPermissions(...e)},n(h.allPermissionsSelected?`取消全选`:`全选权限`),1),l(`button`,{class:`action-button`,onClick:u[3]||=(...e)=>h.saveRolePermissions&&h.saveRolePermissions(...e)},`保存配置`)]),l(`div`,I,[(t(!0),i(m,null,g(h.permissionCategories,e=>(t(),i(`div`,{key:e.id,class:`permission-category`},[l(`div`,L,[l(`input`,{type:`checkbox`,id:`category-${e.id}`,checked:h.isCategoryChecked(e.id),indeterminate:h.isCategoryIndeterminate(e.id),onChange:t=>h.toggleCategory(e.id)},null,40,ee),l(`label`,{for:`category-${e.id}`},n(e.name),9,R)]),l(`div`,z,[(t(!0),i(m,null,g(e.permissions,e=>(t(),i(`div`,{key:e.id,class:`permission-item`},[r(l(`input`,{type:`checkbox`,id:`perm-${e.id}`,"onUpdate:modelValue":u[4]||=e=>h.selectedRole.permissions=e,value:e.code},null,8,B),[[a,h.selectedRole.permissions]]),l(`label`,{for:`perm-${e.id}`},[l(`span`,H,n(e.name),1),l(`span`,U,n(e.description),1)],8,V)]))),128))])]))),128))])])):c(``,!0),h.showAddRoleDialog||h.showEditRoleDialog?(t(),i(`div`,{key:1,class:`dialog-overlay`,onClick:u[17]||=(...e)=>h.closeRoleDialog&&h.closeRoleDialog(...e)},[l(`div`,{class:`dialog-content`,onClick:u[16]||=s(()=>{},[`stop`])},[l(`div`,W,[l(`h3`,null,n(h.showEditRoleDialog?`编辑角色`:`添加角色`),1),l(`button`,{class:`close-button`,onClick:u[5]||=(...e)=>h.closeRoleDialog&&h.closeRoleDialog(...e)},`×`)]),l(`div`,G,[l(`form`,{onSubmit:u[13]||=s((...e)=>h.saveRole&&h.saveRole(...e),[`prevent`])},[l(`div`,K,[u[20]||=l(`label`,null,`角色名称`,-1),r(l(`input`,{type:`text`,"onUpdate:modelValue":u[6]||=e=>h.roleForm.name=e,required:``,class:`form-input`},null,512),[[o,h.roleForm.name]])]),l(`div`,q,[u[21]||=l(`label`,null,`角色描述`,-1),r(l(`textarea`,{"onUpdate:modelValue":u[7]||=e=>h.roleForm.description=e,rows:`3`,class:`form-input`},null,512),[[o,h.roleForm.description]])]),l(`div`,J,[l(`label`,null,[r(l(`input`,{type:`checkbox`,"onUpdate:modelValue":u[8]||=e=>h.roleForm.protected=e},null,512),[[a,h.roleForm.protected]]),u[22]||=v(` 设为受保护（禁止删除） `,-1)])]),l(`div`,Y,[u[27]||=l(`label`,null,`初始权限`,-1),l(`div`,X,[l(`label`,null,[r(l(`input`,{type:`radio`,"onUpdate:modelValue":u[9]||=e=>h.roleForm.initialPermissionSet=e,value:`none`},null,512),[[f,h.roleForm.initialPermissionSet]]),u[23]||=v(` 无权限 `,-1)]),l(`label`,null,[r(l(`input`,{type:`radio`,"onUpdate:modelValue":u[10]||=e=>h.roleForm.initialPermissionSet=e,value:`student`},null,512),[[f,h.roleForm.initialPermissionSet]]),u[24]||=v(` 学生权限 `,-1)]),l(`label`,null,[r(l(`input`,{type:`radio`,"onUpdate:modelValue":u[11]||=e=>h.roleForm.initialPermissionSet=e,value:`teacher`},null,512),[[f,h.roleForm.initialPermissionSet]]),u[25]||=v(` 教师权限 `,-1)]),l(`label`,null,[r(l(`input`,{type:`radio`,"onUpdate:modelValue":u[12]||=e=>h.roleForm.initialPermissionSet=e,value:`admin`},null,512),[[f,h.roleForm.initialPermissionSet]]),u[26]||=v(` 管理员权限 `,-1)])])])],32)]),l(`div`,Z,[l(`button`,{class:`action-button`,onClick:u[14]||=(...e)=>h.closeRoleDialog&&h.closeRoleDialog(...e)},`取消`),l(`button`,{class:`action-button primary`,onClick:u[15]||=(...e)=>h.saveRole&&h.saveRole(...e)},`保存`)])])])):c(``,!0)])}var $=h(y,[[`render`,Q],[`__scopeId`,`data-v-90d2dd23`]]);export{$ as default};