import{A as e,C as t,M as n,N as r,O as i,_ as a,d as o,f as s,g as c,h as l,i as u,j as d,m as f,p,s as m,u as h,w as g,x as ee}from"./index-D-ACJEW6.js";var _={name:`SystemBackup`,setup(){let t=e([]),n=e(``),r=e(`all`),i=e(1),a=e(!1),o=e(!1),s=e(!1),c=e(!1),l=e(0),d=e(``),p=e([]),m=e(null),h=e(``),g=e(null),_=e(``),v=e(``),y=e(``),b={completed:`已完成`,failed:`失败`,pending:`等待中`,running:`运行中`},x=()=>{u.adminData&&u.adminData.backups?t.value=u.adminData.backups:t.value=[{id:1,name:`自动备份_20231101`,timestamp:new Date(`2023-11-01T02:00:00`).getTime(),type:`full`,size:1024*1024*100,status:`completed`,encrypted:!0,createdBy:`系统自动`},{id:2,name:`手动备份_20231028`,timestamp:new Date(`2023-10-28T14:30:00`).getTime(),type:`full`,size:1024*1024*95,status:`completed`,encrypted:!1,createdBy:`admin`},{id:3,name:`增量备份_20231025`,timestamp:new Date(`2023-10-25T02:00:00`).getTime(),type:`incremental`,size:1024*1024*20,status:`completed`,encrypted:!0,createdBy:`系统自动`},{id:4,name:`自动备份_20231020`,timestamp:new Date(`2023-10-20T02:00:00`).getTime(),type:`full`,size:1024*1024*98,status:`completed`,encrypted:!1,createdBy:`系统自动`},{id:5,name:`备份失败示例`,timestamp:new Date(`2023-10-15T02:00:00`).getTime(),type:`full`,size:0,status:`failed`,encrypted:!1,createdBy:`系统自动`}]},S=f(()=>{let e=[...t.value];if(n.value){let t=n.value.toLowerCase();e=e.filter(e=>e.name.toLowerCase().includes(t)||e.createdBy.toLowerCase().includes(t)||new Date(e.timestamp).toLocaleDateString().includes(t))}return r.value!==`all`&&(e=r.value===`encrypted`?e.filter(e=>e.encrypted):r.value===`unencrypted`?e.filter(e=>!e.encrypted):e.filter(e=>e.status===r.value)),backupType.value!==`all`&&(e=e.filter(e=>e.type===backupType.value)),e.sort((e,t)=>sortBy.value===`time`?sortOrder.value===`desc`?t.timestamp-e.timestamp:e.timestamp-t.timestamp:sortBy.value===`size`?sortOrder.value===`desc`?t.size-e.size:e.size-t.size:sortBy.value===`name`?sortOrder.value===`asc`?e.name.localeCompare(t.name):t.name.localeCompare(e.name):0),e});f(()=>{let e=parseInt(backupPageSize.value)||10,t=(i.value-1)*e;return S.value.slice(t,t+e)});let C=f(()=>{let e=[...t.value];if(n.value){let t=n.value.toLowerCase();e=e.filter(e=>e.name.toLowerCase().includes(t)||e.createdBy.toLowerCase().includes(t)||new Date(e.timestamp).toLocaleDateString().includes(t))}r.value!==`all`&&(e=e.filter(e=>r.value===`encrypted`?e.encrypted:r.value===`unencrypted`?!e.encrypted:e.status===r.value)),backupType.value!==`all`&&(e=e.filter(e=>e.type===backupType.value));let i=parseInt(backupPageSize.value)||10;return Math.ceil(e.length/i)}),w=f(()=>{if(t.value.length===0)return null;let e=t.value.reduce((e,t)=>t.timestamp>e.timestamp?t:e);return O(e.timestamp)}),T=f(()=>t.value.filter(e=>e.encrypted).length),E=f(()=>{let e=t.value.reduce((e,t)=>e+t.size,0);return k(e)}),D=f(()=>`已启用 (每天 02:00)`),O=e=>e?new Date(e).toLocaleString(`zh-CN`,{year:`numeric`,month:`2-digit`,day:`2-digit`,hour:`2-digit`,minute:`2-digit`}):``,k=e=>{if(e===0)return`0 B`;let t=1024,n=[`B`,`KB`,`MB`,`GB`,`TB`],r=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/t**+r).toFixed(2))+` `+n[r]},A=()=>{confirm(`确定要立即执行备份吗？这可能需要一些时间。`)&&(a.value=!0,l.value=0,d.value=`准备备份...`,p.value=[],j())},j=()=>{let e=[`开始备份操作...`,`连接数据库...`,`备份用户数据...`,`备份课程数据...`,`备份成绩数据...`,`生成备份文件...`,`备份完成！`],n=0,r=setInterval(()=>{n<e.length?(p.value.push(e[n]),n++,l.value=Math.floor(n/e.length*100),n<e.length-1?d.value=`备份中 (${n}/${e.length-1})`:d.value=`备份完成`):(clearInterval(r),setTimeout(()=>{let e={id:t.value.length+1,name:`手动备份_${new Date().toISOString().slice(0,10)}`,timestamp:Date.now(),type:`full`,size:Math.floor(Math.random()*50+50)*1024*1024,status:`completed`,encrypted:!0,createdBy:u.username};t.value.unshift(e),a.value=!1,c.value=!0,v.value=`备份成功`,y.value=`数据备份已成功完成，备份文件已保存到系统中。`},1e3))},800)};return ee(()=>{x(),u.role!==`superAdmin`&&alert(`权限不足，请联系超级管理员`)}),{backups:t,searchQuery:n,filterType:r,currentPage:i,pageSize:10,filteredBackups:S,totalPages:C,lastBackupTime:w,encryptedBackups:T,totalBackupSize:E,autoBackupStatus:D,showBackupProgress:a,showRestoreDialog:o,showImportDialog:s,showSuccessDialog:c,backupProgress:l,backupStatusText:d,backupLogs:p,selectedBackup:m,restorePassword:h,importedFile:g,importPassword:_,successDialogTitle:v,successDialogMessage:y,statusText:b,formatDate:O,formatSize:k,runBackup:A,downloadBackup:e=>{alert(`开始下载备份文件: ${e.name}`)},deleteBackup:(e,n)=>{confirm(`确定要删除备份文件 "${n}" 吗？此操作不可恢复！`)&&(t.value=t.value.filter(t=>t.id!==e),c.value=!0,v.value=`删除成功`,y.value=`备份文件已成功删除。`)},confirmRestore:()=>{if(m.value){if(m.value.encrypted&&!h.value){alert(`请输入备份加密密码`);return}confirm(`最后确认：此操作将覆盖当前所有数据，一旦开始无法中断！`)&&(o.value=!1,c.value=!0,v.value=`恢复操作已开始`,y.value=`系统数据恢复正在进行中，请稍后查看结果。`,h.value=``,m.value=null)}},cancelRestore:()=>{o.value=!1,h.value=``,m.value=null},handleFileImport:e=>{let t=e.target.files[0];t&&(g.value={name:t.name,size:t.size,encrypted:Math.random()>.5})},confirmImport:()=>{if(!g.value)return;let e={id:t.value.length+1,name:g.value.name,timestamp:Date.now(),type:`full`,size:g.value.size,status:`completed`,encrypted:g.value.encrypted,createdBy:u.username};t.value.unshift(e),s.value=!1,c.value=!0,v.value=`导入成功`,y.value=`备份文件已成功导入到系统中。`,g.value=null,_.value=``},cancelImport:()=>{s.value=!1,g.value=null,_.value=``},goToBackupSettings:()=>{alert(`跳转到备份设置页面`)}}}},v={class:`system-backup`},y={class:`page-header`},b={class:`header-actions`},x={class:`backup-overview`},S={class:`overview-card`},C={class:`overview-content`},w={class:`overview-value`},T={class:`overview-card`},E={class:`overview-content`},D={class:`overview-value`},O={class:`overview-card`},k={class:`overview-content`},A={class:`overview-value`},j={class:`overview-card`},te={class:`overview-content`},M={class:`overview-value`},N={class:`backup-settings-quick`},P={class:`settings-info`},F={class:`backup-history`},I={class:`history-header`},L={class:`history-actions`},R={class:`search-box`},z={class:`backup-table-container`},B={class:`backup-table`},V={class:`backup-actions`},H=[`onClick`],U=[`onClick`],W=[`onClick`],G={key:0},K={key:0,class:`pagination`},q=[`disabled`],J={class:`page-info`},Y=[`disabled`],X={key:0,class:`dialog-overlay`},Z={class:`dialog-content`},Q={class:`dialog-body`},ne={class:`progress-container`},re={class:`progress-bar`},ie={class:`progress-info`},ae={class:`backup-logs`},oe={class:`dialog-header`},se={class:`dialog-body`},ce={class:`restore-details`},le={class:`detail-item`},ue={class:`detail-value`},de={class:`detail-item`},fe={class:`detail-value`},pe={class:`detail-item`},me={class:`detail-value`},he={key:0,class:`restore-password`},ge={class:`dialog-footer`},_e={class:`dialog-header`},ve={class:`dialog-body`},ye={class:`import-instruction`},be={key:0,class:`file-info`},$={key:0,class:`import-password`},xe={class:`dialog-footer`},Se=[`disabled`],Ce={class:`dialog-header`},we={class:`dialog-body`},Te={class:`dialog-footer`};function Ee(e,u,f,m,ee,_){return t(),a(`div`,v,[l(`div`,y,[u[23]||=l(`h2`,null,`数据备份与恢复`,-1),l(`div`,b,[l(`button`,{class:`action-button primary`,onClick:u[0]||=(...e)=>m.runBackup&&m.runBackup(...e)},`立即备份`),l(`button`,{class:`action-button`,onClick:u[1]||=e=>m.showImportDialog=!0},`导入备份`)])]),l(`div`,x,[l(`div`,S,[u[25]||=l(`div`,{class:`overview-icon`},`📊`,-1),l(`div`,C,[u[24]||=l(`div`,{class:`overview-title`},`总备份数`,-1),l(`div`,w,r(m.backups.length),1)])]),l(`div`,T,[u[27]||=l(`div`,{class:`overview-icon`},`🗓️`,-1),l(`div`,E,[u[26]||=l(`div`,{class:`overview-title`},`最后备份`,-1),l(`div`,D,r(m.lastBackupTime||`从未备份`),1)])]),l(`div`,O,[u[29]||=l(`div`,{class:`overview-icon`},`🔒`,-1),l(`div`,k,[u[28]||=l(`div`,{class:`overview-title`},`加密备份`,-1),l(`div`,A,r(m.encryptedBackups),1)])]),l(`div`,j,[u[31]||=l(`div`,{class:`overview-icon`},`💾`,-1),l(`div`,te,[u[30]||=l(`div`,{class:`overview-title`},`总占用空间`,-1),l(`div`,M,r(m.totalBackupSize),1)])])]),l(`div`,N,[l(`div`,P,[u[32]||=l(`h3`,null,`自动备份设置`,-1),l(`p`,null,`当前配置: `+r(m.autoBackupStatus),1)]),l(`button`,{class:`action-button`,onClick:u[2]||=(...e)=>m.goToBackupSettings&&m.goToBackupSettings(...e)},`管理备份设置`)]),l(`div`,F,[l(`div`,I,[u[34]||=l(`h3`,null,`备份历史`,-1),l(`div`,L,[l(`div`,R,[i(l(`input`,{type:`text`,"onUpdate:modelValue":u[3]||=e=>m.searchQuery=e,placeholder:`搜索备份...`,class:`search-input`},null,512),[[o,m.searchQuery]])]),i(l(`select`,{"onUpdate:modelValue":u[4]||=e=>m.filterType=e,class:`filter-select`},[...u[33]||=[l(`option`,{value:`all`},`全部备份`,-1),l(`option`,{value:`full`},`完整备份`,-1),l(`option`,{value:`incremental`},`增量备份`,-1),l(`option`,{value:`encrypted`},`加密备份`,-1)]],512),[[h,m.filterType]])])]),l(`div`,z,[l(`table`,B,[u[36]||=l(`thead`,null,[l(`tr`,null,[l(`th`,null,`备份名称`),l(`th`,null,`备份时间`),l(`th`,null,`类型`),l(`th`,null,`大小`),l(`th`,null,`状态`),l(`th`,null,`创建人`),l(`th`,null,`操作`)])],-1),l(`tbody`,null,[(t(!0),a(p,null,g(m.filteredBackups,e=>(t(),a(`tr`,{key:e.id},[l(`td`,null,r(e.name),1),l(`td`,null,r(m.formatDate(e.timestamp)),1),l(`td`,null,[l(`span`,{class:d([`backup-type`,e.type])},r(e.type===`full`?`完整备份`:`增量备份`),3)]),l(`td`,null,r(m.formatSize(e.size)),1),l(`td`,null,[l(`span`,{class:d([`backup-status`,e.status])},r(m.statusText[e.status]),3)]),l(`td`,null,r(e.createdBy),1),l(`td`,null,[l(`div`,V,[l(`button`,{class:`mini-button`,onClick:t=>m.downloadBackup(e),title:`下载备份`},` 📥 下载 `,8,H),l(`button`,{class:`mini-button`,onClick:t=>{m.showRestoreDialog=!0,m.selectedBackup=e},title:`恢复备份`},` ⏪ 恢复 `,8,U),l(`button`,{class:`mini-button delete`,onClick:t=>m.deleteBackup(e.id,e.name),title:`删除备份`},` 🗑️ 删除 `,8,W)])])]))),128)),m.filteredBackups.length===0?(t(),a(`tr`,G,[...u[35]||=[l(`td`,{colspan:`7`,class:`no-data`},`无符合条件的备份记录`,-1)]])):c(``,!0)])])]),m.filteredBackups.length>0?(t(),a(`div`,K,[l(`button`,{class:`page-button`,disabled:m.currentPage===1,onClick:u[5]||=e=>m.currentPage--},` 上一页 `,8,q),l(`span`,J,` 第 `+r(m.currentPage)+` 页，共 `+r(m.totalPages)+` 页 `,1),l(`button`,{class:`page-button`,disabled:m.currentPage===m.totalPages,onClick:u[6]||=e=>m.currentPage++},` 下一页 `,8,Y)])):c(``,!0)]),m.showBackupProgress?(t(),a(`div`,X,[l(`div`,Z,[u[37]||=l(`div`,{class:`dialog-header`},[l(`h3`,null,`正在执行备份`)],-1),l(`div`,Q,[l(`div`,ne,[l(`div`,re,[l(`div`,{class:`progress-fill`,style:n({width:m.backupProgress+`%`})},null,4)]),l(`div`,ie,[l(`span`,null,`进度: `+r(m.backupProgress)+`%`,1),l(`span`,null,r(m.backupStatusText),1)])]),l(`div`,ae,[(t(!0),a(p,null,g(m.backupLogs,(e,n)=>(t(),a(`div`,{key:n,class:`log-item`},r(e),1))),128))])])])])):c(``,!0),m.showRestoreDialog?(t(),a(`div`,{key:1,class:`dialog-overlay`,onClick:u[12]||=(...e)=>m.cancelRestore&&m.cancelRestore(...e)},[l(`div`,{class:`dialog-content`,onClick:u[11]||=s(()=>{},[`stop`])},[l(`div`,oe,[u[38]||=l(`h3`,null,`确认恢复备份`,-1),l(`button`,{class:`close-button`,onClick:u[7]||=(...e)=>m.cancelRestore&&m.cancelRestore(...e)},`×`)]),l(`div`,se,[u[44]||=l(`div`,{class:`restore-warning`},[l(`span`,{class:`warning-icon`},`⚠️`),l(`div`,null,[l(`p`,{class:`warning-title`},`数据恢复警告`),l(`p`,null,`恢复操作将覆盖当前系统数据，此操作不可撤销！`)])],-1),l(`div`,ce,[u[42]||=l(`h4`,null,`备份详情`,-1),l(`div`,le,[u[39]||=l(`span`,{class:`detail-label`},`备份名称:`,-1),l(`span`,ue,r(m.selectedBackup?.name),1)]),l(`div`,de,[u[40]||=l(`span`,{class:`detail-label`},`备份时间:`,-1),l(`span`,fe,r(m.formatDate(m.selectedBackup?.timestamp)),1)]),l(`div`,pe,[u[41]||=l(`span`,{class:`detail-label`},`备份类型:`,-1),l(`span`,me,r(m.selectedBackup?.type===`full`?`完整备份`:`增量备份`),1)])]),m.selectedBackup?.encrypted?(t(),a(`div`,he,[u[43]||=l(`label`,null,`备份加密密码`,-1),i(l(`input`,{type:`password`,"onUpdate:modelValue":u[8]||=e=>m.restorePassword=e,class:`form-input`,placeholder:`请输入备份加密密码`},null,512),[[o,m.restorePassword]])])):c(``,!0)]),l(`div`,ge,[l(`button`,{class:`action-button`,onClick:u[9]||=(...e)=>m.cancelRestore&&m.cancelRestore(...e)},`取消`),l(`button`,{class:`action-button danger`,onClick:u[10]||=(...e)=>m.confirmRestore&&m.confirmRestore(...e)},`确认恢复`)])])])):c(``,!0),m.showImportDialog?(t(),a(`div`,{key:2,class:`dialog-overlay`,onClick:u[19]||=(...e)=>m.cancelImport&&m.cancelImport(...e)},[l(`div`,{class:`dialog-content`,onClick:u[18]||=s(()=>{},[`stop`])},[l(`div`,_e,[u[45]||=l(`h3`,null,`导入备份`,-1),l(`button`,{class:`close-button`,onClick:u[13]||=(...e)=>m.cancelImport&&m.cancelImport(...e)},`×`)]),l(`div`,ve,[l(`div`,ye,[u[46]||=l(`p`,null,`请选择要导入的备份文件：`,-1),l(`input`,{type:`file`,accept:`.backup,.zip`,onChange:u[14]||=(...e)=>m.handleFileImport&&m.handleFileImport(...e),class:`file-input`},null,32),m.importedFile?(t(),a(`div`,be,[l(`span`,null,`已选择: `+r(m.importedFile.name),1),l(`span`,null,r(m.formatSize(m.importedFile.size)),1)])):c(``,!0)]),m.importedFile?.encrypted?(t(),a(`div`,$,[u[47]||=l(`label`,null,`备份加密密码`,-1),i(l(`input`,{type:`password`,"onUpdate:modelValue":u[15]||=e=>m.importPassword=e,class:`form-input`,placeholder:`请输入备份加密密码`},null,512),[[o,m.importPassword]])])):c(``,!0),u[48]||=l(`div`,{class:`import-warning`},[l(`span`,{class:`warning-icon`},`⚠️`),l(`p`,null,`导入备份文件将添加到备份历史，但不会自动恢复数据`)],-1)]),l(`div`,xe,[l(`button`,{class:`action-button`,onClick:u[16]||=(...e)=>m.cancelImport&&m.cancelImport(...e)},`取消`),l(`button`,{class:`action-button primary`,onClick:u[17]||=(...e)=>m.confirmImport&&m.confirmImport(...e),disabled:!m.importedFile},` 确认导入 `,8,Se)])])])):c(``,!0),m.showSuccessDialog?(t(),a(`div`,{key:3,class:`dialog-overlay`,onClick:u[22]||=e=>m.showSuccessDialog=!1},[l(`div`,{class:`dialog-content`,onClick:u[21]||=s(()=>{},[`stop`])},[l(`div`,Ce,[l(`h3`,null,r(m.successDialogTitle),1)]),l(`div`,we,[u[49]||=l(`div`,{class:`success-icon`},`✅`,-1),l(`p`,null,r(m.successDialogMessage),1)]),l(`div`,Te,[l(`button`,{class:`action-button primary`,onClick:u[20]||=e=>m.showSuccessDialog=!1},`确定`)])])])):c(``,!0)])}var De=m(_,[[`render`,Ee],[`__scopeId`,`data-v-0a3acec9`]]);export{De as default};