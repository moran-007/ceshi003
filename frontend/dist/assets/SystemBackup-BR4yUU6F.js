import{A as e,C as t,M as n,N as r,O as i,_ as a,d as o,f as s,g as c,h as l,i as u,j as d,m as f,p,s as m,u as h,w as g,x as ee}from"./index-D-ACJEW6.js";var _={name:`SystemBackup`,setup(){let t=e([]),n=e(``),r=e(`all`),i=e(1),a=e(!1),o=e(!1),s=e(!1),c=e(!1),l=e(0),d=e(``),p=e([]),m=e(null),h=e(``),g=e(null),_=e(``),v=e(``),y=e(``),b={completed:`å·²å®Œæˆ`,failed:`å¤±è´¥`,pending:`ç­‰å¾…ä¸­`,running:`è¿è¡Œä¸­`},x=()=>{u.adminData&&u.adminData.backups?t.value=u.adminData.backups:t.value=[{id:1,name:`è‡ªåŠ¨å¤‡ä»½_20231101`,timestamp:new Date(`2023-11-01T02:00:00`).getTime(),type:`full`,size:1024*1024*100,status:`completed`,encrypted:!0,createdBy:`ç³»ç»Ÿè‡ªåŠ¨`},{id:2,name:`æ‰‹åŠ¨å¤‡ä»½_20231028`,timestamp:new Date(`2023-10-28T14:30:00`).getTime(),type:`full`,size:1024*1024*95,status:`completed`,encrypted:!1,createdBy:`admin`},{id:3,name:`å¢žé‡å¤‡ä»½_20231025`,timestamp:new Date(`2023-10-25T02:00:00`).getTime(),type:`incremental`,size:1024*1024*20,status:`completed`,encrypted:!0,createdBy:`ç³»ç»Ÿè‡ªåŠ¨`},{id:4,name:`è‡ªåŠ¨å¤‡ä»½_20231020`,timestamp:new Date(`2023-10-20T02:00:00`).getTime(),type:`full`,size:1024*1024*98,status:`completed`,encrypted:!1,createdBy:`ç³»ç»Ÿè‡ªåŠ¨`},{id:5,name:`å¤‡ä»½å¤±è´¥ç¤ºä¾‹`,timestamp:new Date(`2023-10-15T02:00:00`).getTime(),type:`full`,size:0,status:`failed`,encrypted:!1,createdBy:`ç³»ç»Ÿè‡ªåŠ¨`}]},S=f(()=>{let e=[...t.value];if(n.value){let t=n.value.toLowerCase();e=e.filter(e=>e.name.toLowerCase().includes(t)||e.createdBy.toLowerCase().includes(t)||new Date(e.timestamp).toLocaleDateString().includes(t))}return r.value!==`all`&&(e=r.value===`encrypted`?e.filter(e=>e.encrypted):r.value===`unencrypted`?e.filter(e=>!e.encrypted):e.filter(e=>e.status===r.value)),backupType.value!==`all`&&(e=e.filter(e=>e.type===backupType.value)),e.sort((e,t)=>sortBy.value===`time`?sortOrder.value===`desc`?t.timestamp-e.timestamp:e.timestamp-t.timestamp:sortBy.value===`size`?sortOrder.value===`desc`?t.size-e.size:e.size-t.size:sortBy.value===`name`?sortOrder.value===`asc`?e.name.localeCompare(t.name):t.name.localeCompare(e.name):0),e});f(()=>{let e=parseInt(backupPageSize.value)||10,t=(i.value-1)*e;return S.value.slice(t,t+e)});let C=f(()=>{let e=[...t.value];if(n.value){let t=n.value.toLowerCase();e=e.filter(e=>e.name.toLowerCase().includes(t)||e.createdBy.toLowerCase().includes(t)||new Date(e.timestamp).toLocaleDateString().includes(t))}r.value!==`all`&&(e=e.filter(e=>r.value===`encrypted`?e.encrypted:r.value===`unencrypted`?!e.encrypted:e.status===r.value)),backupType.value!==`all`&&(e=e.filter(e=>e.type===backupType.value));let i=parseInt(backupPageSize.value)||10;return Math.ceil(e.length/i)}),w=f(()=>{if(t.value.length===0)return null;let e=t.value.reduce((e,t)=>t.timestamp>e.timestamp?t:e);return O(e.timestamp)}),T=f(()=>t.value.filter(e=>e.encrypted).length),E=f(()=>{let e=t.value.reduce((e,t)=>e+t.size,0);return k(e)}),D=f(()=>`å·²å¯ç”¨ (æ¯å¤© 02:00)`),O=e=>e?new Date(e).toLocaleString(`zh-CN`,{year:`numeric`,month:`2-digit`,day:`2-digit`,hour:`2-digit`,minute:`2-digit`}):``,k=e=>{if(e===0)return`0 B`;let t=1024,n=[`B`,`KB`,`MB`,`GB`,`TB`],r=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/t**+r).toFixed(2))+` `+n[r]},A=()=>{confirm(`ç¡®å®šè¦ç«‹å³æ‰§è¡Œå¤‡ä»½å—ï¼Ÿè¿™å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´ã€‚`)&&(a.value=!0,l.value=0,d.value=`å‡†å¤‡å¤‡ä»½...`,p.value=[],j())},j=()=>{let e=[`å¼€å§‹å¤‡ä»½æ“ä½œ...`,`è¿žæŽ¥æ•°æ®åº“...`,`å¤‡ä»½ç”¨æˆ·æ•°æ®...`,`å¤‡ä»½è¯¾ç¨‹æ•°æ®...`,`å¤‡ä»½æˆç»©æ•°æ®...`,`ç”Ÿæˆå¤‡ä»½æ–‡ä»¶...`,`å¤‡ä»½å®Œæˆï¼`],n=0,r=setInterval(()=>{n<e.length?(p.value.push(e[n]),n++,l.value=Math.floor(n/e.length*100),n<e.length-1?d.value=`å¤‡ä»½ä¸­ (${n}/${e.length-1})`:d.value=`å¤‡ä»½å®Œæˆ`):(clearInterval(r),setTimeout(()=>{let e={id:t.value.length+1,name:`æ‰‹åŠ¨å¤‡ä»½_${new Date().toISOString().slice(0,10)}`,timestamp:Date.now(),type:`full`,size:Math.floor(Math.random()*50+50)*1024*1024,status:`completed`,encrypted:!0,createdBy:u.username};t.value.unshift(e),a.value=!1,c.value=!0,v.value=`å¤‡ä»½æˆåŠŸ`,y.value=`æ•°æ®å¤‡ä»½å·²æˆåŠŸå®Œæˆï¼Œå¤‡ä»½æ–‡ä»¶å·²ä¿å­˜åˆ°ç³»ç»Ÿä¸­ã€‚`},1e3))},800)};return ee(()=>{x(),u.role!==`superAdmin`&&alert(`æƒé™ä¸è¶³ï¼Œè¯·è”ç³»è¶…çº§ç®¡ç†å‘˜`)}),{backups:t,searchQuery:n,filterType:r,currentPage:i,pageSize:10,filteredBackups:S,totalPages:C,lastBackupTime:w,encryptedBackups:T,totalBackupSize:E,autoBackupStatus:D,showBackupProgress:a,showRestoreDialog:o,showImportDialog:s,showSuccessDialog:c,backupProgress:l,backupStatusText:d,backupLogs:p,selectedBackup:m,restorePassword:h,importedFile:g,importPassword:_,successDialogTitle:v,successDialogMessage:y,statusText:b,formatDate:O,formatSize:k,runBackup:A,downloadBackup:e=>{alert(`å¼€å§‹ä¸‹è½½å¤‡ä»½æ–‡ä»¶: ${e.name}`)},deleteBackup:(e,n)=>{confirm(`ç¡®å®šè¦åˆ é™¤å¤‡ä»½æ–‡ä»¶ "${n}" å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼`)&&(t.value=t.value.filter(t=>t.id!==e),c.value=!0,v.value=`åˆ é™¤æˆåŠŸ`,y.value=`å¤‡ä»½æ–‡ä»¶å·²æˆåŠŸåˆ é™¤ã€‚`)},confirmRestore:()=>{if(m.value){if(m.value.encrypted&&!h.value){alert(`è¯·è¾“å…¥å¤‡ä»½åŠ å¯†å¯†ç `);return}confirm(`æœ€åŽç¡®è®¤ï¼šæ­¤æ“ä½œå°†è¦†ç›–å½“å‰æ‰€æœ‰æ•°æ®ï¼Œä¸€æ—¦å¼€å§‹æ— æ³•ä¸­æ–­ï¼`)&&(o.value=!1,c.value=!0,v.value=`æ¢å¤æ“ä½œå·²å¼€å§‹`,y.value=`ç³»ç»Ÿæ•°æ®æ¢å¤æ­£åœ¨è¿›è¡Œä¸­ï¼Œè¯·ç¨åŽæŸ¥çœ‹ç»“æžœã€‚`,h.value=``,m.value=null)}},cancelRestore:()=>{o.value=!1,h.value=``,m.value=null},handleFileImport:e=>{let t=e.target.files[0];t&&(g.value={name:t.name,size:t.size,encrypted:Math.random()>.5})},confirmImport:()=>{if(!g.value)return;let e={id:t.value.length+1,name:g.value.name,timestamp:Date.now(),type:`full`,size:g.value.size,status:`completed`,encrypted:g.value.encrypted,createdBy:u.username};t.value.unshift(e),s.value=!1,c.value=!0,v.value=`å¯¼å…¥æˆåŠŸ`,y.value=`å¤‡ä»½æ–‡ä»¶å·²æˆåŠŸå¯¼å…¥åˆ°ç³»ç»Ÿä¸­ã€‚`,g.value=null,_.value=``},cancelImport:()=>{s.value=!1,g.value=null,_.value=``},goToBackupSettings:()=>{alert(`è·³è½¬åˆ°å¤‡ä»½è®¾ç½®é¡µé¢`)}}}},v={class:`system-backup`},y={class:`page-header`},b={class:`header-actions`},x={class:`backup-overview`},S={class:`overview-card`},C={class:`overview-content`},w={class:`overview-value`},T={class:`overview-card`},E={class:`overview-content`},D={class:`overview-value`},O={class:`overview-card`},k={class:`overview-content`},A={class:`overview-value`},j={class:`overview-card`},te={class:`overview-content`},M={class:`overview-value`},N={class:`backup-settings-quick`},P={class:`settings-info`},F={class:`backup-history`},I={class:`history-header`},L={class:`history-actions`},R={class:`search-box`},z={class:`backup-table-container`},B={class:`backup-table`},V={class:`backup-actions`},H=[`onClick`],U=[`onClick`],W=[`onClick`],G={key:0},K={key:0,class:`pagination`},q=[`disabled`],J={class:`page-info`},Y=[`disabled`],X={key:0,class:`dialog-overlay`},Z={class:`dialog-content`},Q={class:`dialog-body`},ne={class:`progress-container`},re={class:`progress-bar`},ie={class:`progress-info`},ae={class:`backup-logs`},oe={class:`dialog-header`},se={class:`dialog-body`},ce={class:`restore-details`},le={class:`detail-item`},ue={class:`detail-value`},de={class:`detail-item`},fe={class:`detail-value`},pe={class:`detail-item`},me={class:`detail-value`},he={key:0,class:`restore-password`},ge={class:`dialog-footer`},_e={class:`dialog-header`},ve={class:`dialog-body`},ye={class:`import-instruction`},be={key:0,class:`file-info`},$={key:0,class:`import-password`},xe={class:`dialog-footer`},Se=[`disabled`],Ce={class:`dialog-header`},we={class:`dialog-body`},Te={class:`dialog-footer`};function Ee(e,u,f,m,ee,_){return t(),a(`div`,v,[l(`div`,y,[u[23]||=l(`h2`,null,`æ•°æ®å¤‡ä»½ä¸Žæ¢å¤`,-1),l(`div`,b,[l(`button`,{class:`action-button primary`,onClick:u[0]||=(...e)=>m.runBackup&&m.runBackup(...e)},`ç«‹å³å¤‡ä»½`),l(`button`,{class:`action-button`,onClick:u[1]||=e=>m.showImportDialog=!0},`å¯¼å…¥å¤‡ä»½`)])]),l(`div`,x,[l(`div`,S,[u[25]||=l(`div`,{class:`overview-icon`},`ðŸ“Š`,-1),l(`div`,C,[u[24]||=l(`div`,{class:`overview-title`},`æ€»å¤‡ä»½æ•°`,-1),l(`div`,w,r(m.backups.length),1)])]),l(`div`,T,[u[27]||=l(`div`,{class:`overview-icon`},`ðŸ—“ï¸`,-1),l(`div`,E,[u[26]||=l(`div`,{class:`overview-title`},`æœ€åŽå¤‡ä»½`,-1),l(`div`,D,r(m.lastBackupTime||`ä»Žæœªå¤‡ä»½`),1)])]),l(`div`,O,[u[29]||=l(`div`,{class:`overview-icon`},`ðŸ”’`,-1),l(`div`,k,[u[28]||=l(`div`,{class:`overview-title`},`åŠ å¯†å¤‡ä»½`,-1),l(`div`,A,r(m.encryptedBackups),1)])]),l(`div`,j,[u[31]||=l(`div`,{class:`overview-icon`},`ðŸ’¾`,-1),l(`div`,te,[u[30]||=l(`div`,{class:`overview-title`},`æ€»å ç”¨ç©ºé—´`,-1),l(`div`,M,r(m.totalBackupSize),1)])])]),l(`div`,N,[l(`div`,P,[u[32]||=l(`h3`,null,`è‡ªåŠ¨å¤‡ä»½è®¾ç½®`,-1),l(`p`,null,`å½“å‰é…ç½®: `+r(m.autoBackupStatus),1)]),l(`button`,{class:`action-button`,onClick:u[2]||=(...e)=>m.goToBackupSettings&&m.goToBackupSettings(...e)},`ç®¡ç†å¤‡ä»½è®¾ç½®`)]),l(`div`,F,[l(`div`,I,[u[34]||=l(`h3`,null,`å¤‡ä»½åŽ†å²`,-1),l(`div`,L,[l(`div`,R,[i(l(`input`,{type:`text`,"onUpdate:modelValue":u[3]||=e=>m.searchQuery=e,placeholder:`æœç´¢å¤‡ä»½...`,class:`search-input`},null,512),[[o,m.searchQuery]])]),i(l(`select`,{"onUpdate:modelValue":u[4]||=e=>m.filterType=e,class:`filter-select`},[...u[33]||=[l(`option`,{value:`all`},`å…¨éƒ¨å¤‡ä»½`,-1),l(`option`,{value:`full`},`å®Œæ•´å¤‡ä»½`,-1),l(`option`,{value:`incremental`},`å¢žé‡å¤‡ä»½`,-1),l(`option`,{value:`encrypted`},`åŠ å¯†å¤‡ä»½`,-1)]],512),[[h,m.filterType]])])]),l(`div`,z,[l(`table`,B,[u[36]||=l(`thead`,null,[l(`tr`,null,[l(`th`,null,`å¤‡ä»½åç§°`),l(`th`,null,`å¤‡ä»½æ—¶é—´`),l(`th`,null,`ç±»åž‹`),l(`th`,null,`å¤§å°`),l(`th`,null,`çŠ¶æ€`),l(`th`,null,`åˆ›å»ºäºº`),l(`th`,null,`æ“ä½œ`)])],-1),l(`tbody`,null,[(t(!0),a(p,null,g(m.filteredBackups,e=>(t(),a(`tr`,{key:e.id},[l(`td`,null,r(e.name),1),l(`td`,null,r(m.formatDate(e.timestamp)),1),l(`td`,null,[l(`span`,{class:d([`backup-type`,e.type])},r(e.type===`full`?`å®Œæ•´å¤‡ä»½`:`å¢žé‡å¤‡ä»½`),3)]),l(`td`,null,r(m.formatSize(e.size)),1),l(`td`,null,[l(`span`,{class:d([`backup-status`,e.status])},r(m.statusText[e.status]),3)]),l(`td`,null,r(e.createdBy),1),l(`td`,null,[l(`div`,V,[l(`button`,{class:`mini-button`,onClick:t=>m.downloadBackup(e),title:`ä¸‹è½½å¤‡ä»½`},` ðŸ“¥ ä¸‹è½½ `,8,H),l(`button`,{class:`mini-button`,onClick:t=>{m.showRestoreDialog=!0,m.selectedBackup=e},title:`æ¢å¤å¤‡ä»½`},` âª æ¢å¤ `,8,U),l(`button`,{class:`mini-button delete`,onClick:t=>m.deleteBackup(e.id,e.name),title:`åˆ é™¤å¤‡ä»½`},` ðŸ—‘ï¸ åˆ é™¤ `,8,W)])])]))),128)),m.filteredBackups.length===0?(t(),a(`tr`,G,[...u[35]||=[l(`td`,{colspan:`7`,class:`no-data`},`æ— ç¬¦åˆæ¡ä»¶çš„å¤‡ä»½è®°å½•`,-1)]])):c(``,!0)])])]),m.filteredBackups.length>0?(t(),a(`div`,K,[l(`button`,{class:`page-button`,disabled:m.currentPage===1,onClick:u[5]||=e=>m.currentPage--},` ä¸Šä¸€é¡µ `,8,q),l(`span`,J,` ç¬¬ `+r(m.currentPage)+` é¡µï¼Œå…± `+r(m.totalPages)+` é¡µ `,1),l(`button`,{class:`page-button`,disabled:m.currentPage===m.totalPages,onClick:u[6]||=e=>m.currentPage++},` ä¸‹ä¸€é¡µ `,8,Y)])):c(``,!0)]),m.showBackupProgress?(t(),a(`div`,X,[l(`div`,Z,[u[37]||=l(`div`,{class:`dialog-header`},[l(`h3`,null,`æ­£åœ¨æ‰§è¡Œå¤‡ä»½`)],-1),l(`div`,Q,[l(`div`,ne,[l(`div`,re,[l(`div`,{class:`progress-fill`,style:n({width:m.backupProgress+`%`})},null,4)]),l(`div`,ie,[l(`span`,null,`è¿›åº¦: `+r(m.backupProgress)+`%`,1),l(`span`,null,r(m.backupStatusText),1)])]),l(`div`,ae,[(t(!0),a(p,null,g(m.backupLogs,(e,n)=>(t(),a(`div`,{key:n,class:`log-item`},r(e),1))),128))])])])])):c(``,!0),m.showRestoreDialog?(t(),a(`div`,{key:1,class:`dialog-overlay`,onClick:u[12]||=(...e)=>m.cancelRestore&&m.cancelRestore(...e)},[l(`div`,{class:`dialog-content`,onClick:u[11]||=s(()=>{},[`stop`])},[l(`div`,oe,[u[38]||=l(`h3`,null,`ç¡®è®¤æ¢å¤å¤‡ä»½`,-1),l(`button`,{class:`close-button`,onClick:u[7]||=(...e)=>m.cancelRestore&&m.cancelRestore(...e)},`Ã—`)]),l(`div`,se,[u[44]||=l(`div`,{class:`restore-warning`},[l(`span`,{class:`warning-icon`},`âš ï¸`),l(`div`,null,[l(`p`,{class:`warning-title`},`æ•°æ®æ¢å¤è­¦å‘Š`),l(`p`,null,`æ¢å¤æ“ä½œå°†è¦†ç›–å½“å‰ç³»ç»Ÿæ•°æ®ï¼Œæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼`)])],-1),l(`div`,ce,[u[42]||=l(`h4`,null,`å¤‡ä»½è¯¦æƒ…`,-1),l(`div`,le,[u[39]||=l(`span`,{class:`detail-label`},`å¤‡ä»½åç§°:`,-1),l(`span`,ue,r(m.selectedBackup?.name),1)]),l(`div`,de,[u[40]||=l(`span`,{class:`detail-label`},`å¤‡ä»½æ—¶é—´:`,-1),l(`span`,fe,r(m.formatDate(m.selectedBackup?.timestamp)),1)]),l(`div`,pe,[u[41]||=l(`span`,{class:`detail-label`},`å¤‡ä»½ç±»åž‹:`,-1),l(`span`,me,r(m.selectedBackup?.type===`full`?`å®Œæ•´å¤‡ä»½`:`å¢žé‡å¤‡ä»½`),1)])]),m.selectedBackup?.encrypted?(t(),a(`div`,he,[u[43]||=l(`label`,null,`å¤‡ä»½åŠ å¯†å¯†ç `,-1),i(l(`input`,{type:`password`,"onUpdate:modelValue":u[8]||=e=>m.restorePassword=e,class:`form-input`,placeholder:`è¯·è¾“å…¥å¤‡ä»½åŠ å¯†å¯†ç `},null,512),[[o,m.restorePassword]])])):c(``,!0)]),l(`div`,ge,[l(`button`,{class:`action-button`,onClick:u[9]||=(...e)=>m.cancelRestore&&m.cancelRestore(...e)},`å–æ¶ˆ`),l(`button`,{class:`action-button danger`,onClick:u[10]||=(...e)=>m.confirmRestore&&m.confirmRestore(...e)},`ç¡®è®¤æ¢å¤`)])])])):c(``,!0),m.showImportDialog?(t(),a(`div`,{key:2,class:`dialog-overlay`,onClick:u[19]||=(...e)=>m.cancelImport&&m.cancelImport(...e)},[l(`div`,{class:`dialog-content`,onClick:u[18]||=s(()=>{},[`stop`])},[l(`div`,_e,[u[45]||=l(`h3`,null,`å¯¼å…¥å¤‡ä»½`,-1),l(`button`,{class:`close-button`,onClick:u[13]||=(...e)=>m.cancelImport&&m.cancelImport(...e)},`Ã—`)]),l(`div`,ve,[l(`div`,ye,[u[46]||=l(`p`,null,`è¯·é€‰æ‹©è¦å¯¼å…¥çš„å¤‡ä»½æ–‡ä»¶ï¼š`,-1),l(`input`,{type:`file`,accept:`.backup,.zip`,onChange:u[14]||=(...e)=>m.handleFileImport&&m.handleFileImport(...e),class:`file-input`},null,32),m.importedFile?(t(),a(`div`,be,[l(`span`,null,`å·²é€‰æ‹©: `+r(m.importedFile.name),1),l(`span`,null,r(m.formatSize(m.importedFile.size)),1)])):c(``,!0)]),m.importedFile?.encrypted?(t(),a(`div`,$,[u[47]||=l(`label`,null,`å¤‡ä»½åŠ å¯†å¯†ç `,-1),i(l(`input`,{type:`password`,"onUpdate:modelValue":u[15]||=e=>m.importPassword=e,class:`form-input`,placeholder:`è¯·è¾“å…¥å¤‡ä»½åŠ å¯†å¯†ç `},null,512),[[o,m.importPassword]])])):c(``,!0),u[48]||=l(`div`,{class:`import-warning`},[l(`span`,{class:`warning-icon`},`âš ï¸`),l(`p`,null,`å¯¼å…¥å¤‡ä»½æ–‡ä»¶å°†æ·»åŠ åˆ°å¤‡ä»½åŽ†å²ï¼Œä½†ä¸ä¼šè‡ªåŠ¨æ¢å¤æ•°æ®`)],-1)]),l(`div`,xe,[l(`button`,{class:`action-button`,onClick:u[16]||=(...e)=>m.cancelImport&&m.cancelImport(...e)},`å–æ¶ˆ`),l(`button`,{class:`action-button primary`,onClick:u[17]||=(...e)=>m.confirmImport&&m.confirmImport(...e),disabled:!m.importedFile},` ç¡®è®¤å¯¼å…¥ `,8,Se)])])])):c(``,!0),m.showSuccessDialog?(t(),a(`div`,{key:3,class:`dialog-overlay`,onClick:u[22]||=e=>m.showSuccessDialog=!1},[l(`div`,{class:`dialog-content`,onClick:u[21]||=s(()=>{},[`stop`])},[l(`div`,Ce,[l(`h3`,null,r(m.successDialogTitle),1)]),l(`div`,we,[u[49]||=l(`div`,{class:`success-icon`},`âœ…`,-1),l(`p`,null,r(m.successDialogMessage),1)]),l(`div`,Te,[l(`button`,{class:`action-button primary`,onClick:u[20]||=e=>m.showSuccessDialog=!1},`ç¡®å®š`)])])])):c(``,!0)])}var De=m(_,[[`render`,Ee],[`__scopeId`,`data-v-0a3acec9`]]);export{De as default};