import{A as e,C as t,N as n,O as r,_ as i,d as a,f as o,g as s,h as c,i as l,j as u,k as d,l as f,m as p,p as m,s as h,u as g,v as _,w as v,x as ee,y}from"./index-D-ACJEW6.js";var b={name:`SystemLogs`,setup(){let t=e([]),n=d({level:`all`,actionType:`all`,username:``,startDate:``,endDate:``,ipAddress:``,keyword:``}),r=e(1),i=e(20),a=e(`timestamp`),o=e(`desc`),s=e(null),c=e(!1),u=e(!1),f=e(null),m=e(`all`),h=e(new Date().toISOString().split(`T`)[0]),g=e(`info`),_={info:`信息`,warning:`警告`,error:`错误`,critical:`严重`},v={success:`成功`,failed:`失败`,pending:`处理中`},y=()=>{l.adminData&&l.adminData.logs?t.value=l.adminData.logs:b()},b=()=>{let e=[],n=[`info`,`warning`,`error`,`critical`],r=[{type:`login`,text:`用户登录`,status:`success`},{type:`logout`,text:`用户登出`,status:`success`},{type:`create`,text:`创建用户`,status:`success`},{type:`update`,text:`更新课程信息`,status:`success`},{type:`delete`,text:`删除学生记录`,status:`success`},{type:`query`,text:`查询成绩数据`,status:`success`},{type:`import`,text:`导入用户数据`,status:`success`},{type:`export`,text:`导出课程表`,status:`success`},{type:`backup`,text:`执行系统备份`,status:`success`},{type:`login`,text:`用户登录失败`,status:`failed`},{type:`update`,text:`更新系统配置`,status:`success`}],i=[`admin`,`teacher001`,`teacher002`,`student001`,`superadmin`],a=[`192.168.1.101`,`192.168.1.102`,`10.0.0.5`,`172.16.0.8`,`10.1.1.23`],o=Date.now();for(let t=0;t<200;t++){let s=o-Math.floor(Math.random()*7*864e5),c=Math.floor(Math.random()*r.length),l=r[c],u=n[Math.floor(Math.random()*n.length)];l.status===`failed`&&(u=n[Math.floor(Math.random()*2)+1]);let d={id:t+1,timestamp:s,level:u,username:i[Math.floor(Math.random()*i.length)],actionType:l.type,action:l.text,details:{userId:Math.floor(Math.random()*1e3),actionData:{oldValue:`some old value`,newValue:`some new value`},requestParams:{id:Math.floor(Math.random()*100),name:`Test Name`},responseTime:`${Math.floor(Math.random()*500)}ms`,errorMessage:l.status===`failed`?`Invalid credentials`:null},ipAddress:a[Math.floor(Math.random()*a.length)],status:l.status,userAgent:`Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36`};e.push(d)}e.sort((e,t)=>t.timestamp-e.timestamp),t.value=e},x=p(()=>{let e=[...t.value];if(n.level!==`all`&&(e=e.filter(e=>e.level===n.level)),n.actionType!==`all`&&(e=e.filter(e=>e.actionType===n.actionType)),n.username&&(e=e.filter(e=>e.username.toLowerCase().includes(n.username.toLowerCase()))),n.startDate){let t=new Date(n.startDate).setHours(0,0,0,0);e=e.filter(e=>e.timestamp>=t)}if(n.endDate){let t=new Date(n.endDate).setHours(23,59,59,999);e=e.filter(e=>e.timestamp<=t)}if(n.ipAddress&&(e=e.filter(e=>e.ipAddress.includes(n.ipAddress))),n.keyword){let t=n.keyword.toLowerCase();e=e.filter(e=>e.action.toLowerCase().includes(t)||JSON.stringify(e.details).toLowerCase().includes(t))}return e.sort((e,t)=>{let n=0;if(a.value===`timestamp`)n=e.timestamp-t.timestamp;else if(a.value===`level`){let r={critical:4,error:3,warning:2,info:1};n=r[e.level]-r[t.level]}else a.value===`username`?n=e.username.localeCompare(t.username):a.value===`action`&&(n=e.action.localeCompare(t.action));return o.value===`asc`?n:-n}),e}),S=p(()=>{let e=(r.value-1)*i.value,t=e+i.value;return x.value.slice(e,t)}),C=p(()=>Math.ceil(x.value.length/i.value)),w=p(()=>{let e=C.value,t=r.value,n=[];if(e<=7)for(let t=1;t<=e;t++)n.push(t);else if(t<=4){for(let e=1;e<=5;e++)n.push(e);n.push(`...`),n.push(e)}else if(t>=e-3){n.push(1),n.push(`...`);for(let t=e-4;t<=e;t++)n.push(t)}else{n.push(1),n.push(`...`);for(let e=t-1;e<=t+1;e++)n.push(e);n.push(`...`),n.push(e)}return n}),T=p(()=>{let e=new Date().setHours(0,0,0,0);return t.value.filter(t=>t.timestamp>=e).length}),E=p(()=>t.value.filter(e=>e.level===`warning`).length),D=p(()=>t.value.filter(e=>e.level===`error`||e.level===`critical`).length),O=e=>e?new Date(e).toLocaleString(`zh-CN`,{year:`numeric`,month:`2-digit`,day:`2-digit`,hour:`2-digit`,minute:`2-digit`,second:`2-digit`}):``;return ee(()=>{y(),l.role!==`superAdmin`&&l.role!==`admin`&&alert(`权限不足，请联系管理员`)}),{logs:t,filter:n,currentPage:r,pageSize:i,sortField:a,sortDirection:o,expandedLogId:s,showDetailDialog:c,showClearConfirm:u,selectedLog:f,clearOption:m,clearBeforeDate:h,clearLevel:g,levelText:_,statusText:v,filteredLogs:x,paginatedLogs:S,totalPages:C,pageNumbers:w,todayLogCount:T,warningLogCount:E,errorLogCount:D,formatDateTime:O,truncateText:(e,t)=>{let n=typeof e==`string`?e:JSON.stringify(e);return n.length>t?n.substring(0,t)+`...`:n},formatJson:e=>{try{return JSON.stringify(e,null,2)}catch{return String(e)}},getSortIcon:e=>a.value===e?o.value:``,sortBy:e=>{a.value===e?o.value=o.value===`asc`?`desc`:`asc`:(a.value=e,o.value=`desc`)},expandLog:e=>{s.value=s.value===e.id?null:e.id,f.value=e,c.value=!0},closeDetailDialog:()=>{c.value=!1,s.value=null},applyFilters:()=>{r.value=1},resetFilters:()=>{n.level=`all`,n.actionType=`all`,n.username=``,n.startDate=``,n.endDate=``,n.ipAddress=``,n.keyword=``,r.value=1},refreshLogs:()=>{y(),alert(`日志已刷新`)},clearLogs:()=>{u.value=!0},confirmClearLogs:()=>{if(m.value===`all`)t.value=[];else if(m.value===`older`){let e=new Date(h.value).setHours(0,0,0,0);t.value=t.value.filter(t=>t.timestamp>=e)}else m.value===`level`&&(t.value=t.value.filter(e=>e.level!==g.value));u.value=!1,alert(`日志已清空`),r.value=1},exportLogs:()=>{let e=x.value.map(e=>({日志ID:e.id,时间:O(e.timestamp),级别:_[e.level],操作人:e.username,IP地址:e.ipAddress,操作类型:e.actionType,操作描述:e.action,状态:v[e.status],详情:JSON.stringify(e.details)})),t=Object.keys(e[0]||{}),n=[t.join(`,`),...e.map(e=>t.map(t=>`"${e[t]?.toString().replace(/"/g,`""`)}"`).join(`,`))].join(`
`),r=new Blob([`\uFEFF${n}`],{type:`text/csv;charset=utf-8;`}),i=document.createElement(`a`),a=URL.createObjectURL(r);i.setAttribute(`href`,a),i.setAttribute(`download`,`system_logs_${new Date().toISOString().slice(0,10)}.csv`),i.style.visibility=`hidden`,document.body.appendChild(i),i.click(),document.body.removeChild(i)}}}},x={class:`system-logs`},S={class:`page-header`},C={class:`header-actions`},w={class:`logs-stats`},T={class:`stats-card`},E={class:`stats-content`},D={class:`stats-value`},O={class:`stats-card`},te={class:`stats-content`},k={class:`stats-value`},A={class:`stats-card`},j={class:`stats-content`},M={class:`stats-value`},N={class:`stats-card`},P={class:`stats-content`},F={class:`stats-value`},I={class:`logs-filters`},L={class:`filter-group`},R={class:`filter-group`},z={class:`filter-group`},B={class:`filter-group`},V={class:`date-range`},H={class:`filter-group`},U={class:`filter-group`},W={class:`filter-actions`},G={class:`logs-list`},K={class:`logs-header`},q={class:`logs-info`},J={class:`logs-table-container`},Y={class:`logs-table`},X=[`onClick`],Z={class:`log-details`},Q={class:`details-summary`},ne={key:0,class:`details-full`},re={key:0},ie={key:0,class:`pagination`},ae={class:`page-size-control`},oe={class:`page-navigation`},se=[`disabled`],ce={class:`page-numbers`},le=[`onClick`],ue=[`disabled`],de={class:`page-info`},fe={class:`dialog-header`},pe={class:`dialog-body`},me={class:`log-detail-info`},he={class:`detail-row`},ge={class:`detail-value`},_e={class:`detail-row`},ve={class:`detail-value`},ye={class:`detail-row`},be={class:`detail-value`},xe={class:`detail-row`},Se={class:`detail-value`},Ce={class:`detail-row`},we={class:`detail-value`},Te={class:`detail-row`},Ee={class:`detail-value`},De={class:`detail-row`},$={class:`detail-value`},Oe={class:`detail-row`},ke={class:`detail-value`},Ae={class:`detail-row`},je={class:`detail-value`},Me={class:`log-detail-data`},Ne={class:`dialog-footer`},Pe={class:`dialog-header`},Fe={class:`dialog-body`},Ie={class:`clear-options`},Le={class:`dialog-footer`};function Re(e,l,d,p,h,ee){return t(),i(`div`,x,[c(`div`,S,[l[34]||=c(`h2`,null,`系统操作日志`,-1),c(`div`,C,[c(`button`,{class:`action-button`,onClick:l[0]||=(...e)=>p.refreshLogs&&p.refreshLogs(...e)},`刷新日志`),c(`button`,{class:`action-button`,onClick:l[1]||=(...e)=>p.clearLogs&&p.clearLogs(...e)},`清空日志`),c(`button`,{class:`action-button`,onClick:l[2]||=(...e)=>p.exportLogs&&p.exportLogs(...e)},`导出日志`)])]),c(`div`,w,[c(`div`,T,[l[36]||=c(`div`,{class:`stats-icon`},`📝`,-1),c(`div`,E,[l[35]||=c(`div`,{class:`stats-title`},`今日日志`,-1),c(`div`,D,n(p.todayLogCount),1)])]),c(`div`,O,[l[38]||=c(`div`,{class:`stats-icon`},`⚠️`,-1),c(`div`,te,[l[37]||=c(`div`,{class:`stats-title`},`警告日志`,-1),c(`div`,k,n(p.warningLogCount),1)])]),c(`div`,A,[l[40]||=c(`div`,{class:`stats-icon`},`🚨`,-1),c(`div`,j,[l[39]||=c(`div`,{class:`stats-title`},`错误日志`,-1),c(`div`,M,n(p.errorLogCount),1)])]),c(`div`,N,[l[42]||=c(`div`,{class:`stats-icon`},`👁️`,-1),c(`div`,P,[l[41]||=c(`div`,{class:`stats-title`},`总日志数`,-1),c(`div`,F,n(p.logs.length),1)])])]),c(`div`,I,[c(`div`,L,[l[44]||=c(`label`,null,`日志级别`,-1),r(c(`select`,{"onUpdate:modelValue":l[3]||=e=>p.filter.level=e,class:`filter-select`},[...l[43]||=[_(`<option value="all" data-v-37926d5b>全部级别</option><option value="info" data-v-37926d5b>信息</option><option value="warning" data-v-37926d5b>警告</option><option value="error" data-v-37926d5b>错误</option><option value="critical" data-v-37926d5b>严重</option>`,5)]],512),[[g,p.filter.level]])]),c(`div`,R,[l[46]||=c(`label`,null,`操作类型`,-1),r(c(`select`,{"onUpdate:modelValue":l[4]||=e=>p.filter.actionType=e,class:`filter-select`},[...l[45]||=[_(`<option value="all" data-v-37926d5b>全部操作</option><option value="login" data-v-37926d5b>登录</option><option value="logout" data-v-37926d5b>登出</option><option value="create" data-v-37926d5b>创建</option><option value="update" data-v-37926d5b>更新</option><option value="delete" data-v-37926d5b>删除</option><option value="query" data-v-37926d5b>查询</option><option value="import" data-v-37926d5b>导入</option><option value="export" data-v-37926d5b>导出</option><option value="backup" data-v-37926d5b>备份</option><option value="restore" data-v-37926d5b>恢复</option>`,11)]],512),[[g,p.filter.actionType]])]),c(`div`,z,[l[47]||=c(`label`,null,`操作人`,-1),r(c(`input`,{type:`text`,"onUpdate:modelValue":l[5]||=e=>p.filter.username=e,class:`filter-input`,placeholder:`输入用户名`},null,512),[[a,p.filter.username]])]),c(`div`,B,[l[49]||=c(`label`,null,`时间范围`,-1),c(`div`,V,[r(c(`input`,{type:`date`,"onUpdate:modelValue":l[6]||=e=>p.filter.startDate=e,class:`filter-input`},null,512),[[a,p.filter.startDate]]),l[48]||=c(`span`,{class:`date-separator`},`至`,-1),r(c(`input`,{type:`date`,"onUpdate:modelValue":l[7]||=e=>p.filter.endDate=e,class:`filter-input`},null,512),[[a,p.filter.endDate]])])]),c(`div`,H,[l[50]||=c(`label`,null,`IP地址`,-1),r(c(`input`,{type:`text`,"onUpdate:modelValue":l[8]||=e=>p.filter.ipAddress=e,class:`filter-input`,placeholder:`输入IP地址`},null,512),[[a,p.filter.ipAddress]])]),c(`div`,U,[l[51]||=c(`label`,null,`关键词`,-1),r(c(`input`,{type:`text`,"onUpdate:modelValue":l[9]||=e=>p.filter.keyword=e,class:`filter-input`,placeholder:`输入关键词`},null,512),[[a,p.filter.keyword]])]),c(`div`,W,[c(`button`,{class:`action-button primary`,onClick:l[10]||=(...e)=>p.applyFilters&&p.applyFilters(...e)},`应用筛选`),c(`button`,{class:`action-button`,onClick:l[11]||=(...e)=>p.resetFilters&&p.resetFilters(...e)},`重置筛选`)])]),c(`div`,G,[c(`div`,K,[l[52]||=c(`h3`,null,`日志记录`,-1),c(`div`,q,`显示 `+n(p.filteredLogs.length)+` 条记录`,1)]),c(`div`,J,[c(`table`,Y,[c(`thead`,null,[c(`tr`,null,[c(`th`,{onClick:l[12]||=e=>p.sortBy(`timestamp`),class:`sortable`},[l[53]||=y(` 时间 `,-1),c(`span`,{class:u([`sort-icon`,p.getSortIcon(`timestamp`)])},`⇅`,2)]),c(`th`,{onClick:l[13]||=e=>p.sortBy(`level`),class:`sortable`},[l[54]||=y(` 级别 `,-1),c(`span`,{class:u([`sort-icon`,p.getSortIcon(`level`)])},`⇅`,2)]),c(`th`,{onClick:l[14]||=e=>p.sortBy(`username`),class:`sortable`},[l[55]||=y(` 操作人 `,-1),c(`span`,{class:u([`sort-icon`,p.getSortIcon(`username`)])},`⇅`,2)]),c(`th`,{onClick:l[15]||=e=>p.sortBy(`action`),class:`sortable`},[l[56]||=y(` 操作 `,-1),c(`span`,{class:u([`sort-icon`,p.getSortIcon(`action`)])},`⇅`,2)]),l[57]||=c(`th`,null,`详情`,-1),l[58]||=c(`th`,null,`IP地址`,-1),l[59]||=c(`th`,null,`状态`,-1)])]),c(`tbody`,null,[(t(!0),i(m,null,v(p.paginatedLogs,e=>(t(),i(`tr`,{key:e.id,class:u({"log-error":e.level===`error`||e.level===`critical`,"log-warning":e.level===`warning`}),onClick:t=>p.expandLog(e)},[c(`td`,null,n(p.formatDateTime(e.timestamp)),1),c(`td`,null,[c(`span`,{class:u([`log-level`,e.level])},n(p.levelText[e.level]),3)]),c(`td`,null,n(e.username),1),c(`td`,null,n(e.action),1),c(`td`,Z,[c(`div`,Q,n(p.truncateText(e.details,50)),1),p.expandedLogId===e.id?(t(),i(`div`,ne,[c(`pre`,null,n(p.formatJson(e.details)),1)])):s(``,!0)]),c(`td`,null,n(e.ipAddress),1),c(`td`,null,[c(`span`,{class:u([`log-status`,e.status])},n(p.statusText[e.status]),3)])],10,X))),128)),p.paginatedLogs.length===0?(t(),i(`tr`,re,[...l[60]||=[c(`td`,{colspan:`7`,class:`no-data`},`无符合条件的日志记录`,-1)]])):s(``,!0)])])]),p.filteredLogs.length>0?(t(),i(`div`,ie,[c(`div`,ae,[l[62]||=c(`label`,null,`每页显示:`,-1),r(c(`select`,{"onUpdate:modelValue":l[16]||=e=>p.pageSize=e,onChange:l[17]||=e=>p.currentPage=1},[...l[61]||=[c(`option`,{value:`10`},`10`,-1),c(`option`,{value:`20`},`20`,-1),c(`option`,{value:`50`},`50`,-1),c(`option`,{value:`100`},`100`,-1)]],544),[[g,p.pageSize]])]),c(`div`,oe,[c(`button`,{class:`page-button`,disabled:p.currentPage===1,onClick:l[18]||=e=>p.currentPage--},` 上一页 `,8,se),c(`div`,ce,[(t(!0),i(m,null,v(p.pageNumbers,e=>(t(),i(`button`,{key:e,class:u([`page-number`,{active:e===p.currentPage}]),onClick:t=>p.currentPage=e},n(e),11,le))),128))]),c(`button`,{class:`page-button`,disabled:p.currentPage===p.totalPages,onClick:l[19]||=e=>p.currentPage++},` 下一页 `,8,ue)]),c(`div`,de,` 共 `+n(p.filteredLogs.length)+` 条记录，第 `+n(p.currentPage)+`/`+n(p.totalPages)+` 页 `,1)])):s(``,!0)]),p.showDetailDialog?(t(),i(`div`,{key:0,class:`dialog-overlay`,onClick:l[23]||=(...e)=>p.closeDetailDialog&&p.closeDetailDialog(...e)},[c(`div`,{class:`dialog-content large`,onClick:l[22]||=o(()=>{},[`stop`])},[c(`div`,fe,[l[63]||=c(`h3`,null,`日志详情`,-1),c(`button`,{class:`close-button`,onClick:l[20]||=(...e)=>p.closeDetailDialog&&p.closeDetailDialog(...e)},`×`)]),c(`div`,pe,[c(`div`,me,[c(`div`,he,[l[64]||=c(`span`,{class:`detail-label`},`日志ID:`,-1),c(`span`,ge,n(p.selectedLog?.id),1)]),c(`div`,_e,[l[65]||=c(`span`,{class:`detail-label`},`时间:`,-1),c(`span`,ve,n(p.formatDateTime(p.selectedLog?.timestamp)),1)]),c(`div`,ye,[l[66]||=c(`span`,{class:`detail-label`},`级别:`,-1),c(`span`,be,[c(`span`,{class:u([`log-level`,p.selectedLog?.level])},n(p.levelText[p.selectedLog?.level]),3)])]),c(`div`,xe,[l[67]||=c(`span`,{class:`detail-label`},`操作人:`,-1),c(`span`,Se,n(p.selectedLog?.username),1)]),c(`div`,Ce,[l[68]||=c(`span`,{class:`detail-label`},`IP地址:`,-1),c(`span`,we,n(p.selectedLog?.ipAddress),1)]),c(`div`,Te,[l[69]||=c(`span`,{class:`detail-label`},`操作类型:`,-1),c(`span`,Ee,n(p.selectedLog?.actionType),1)]),c(`div`,De,[l[70]||=c(`span`,{class:`detail-label`},`操作描述:`,-1),c(`span`,$,n(p.selectedLog?.action),1)]),c(`div`,Oe,[l[71]||=c(`span`,{class:`detail-label`},`状态:`,-1),c(`span`,ke,[c(`span`,{class:u([`log-status`,p.selectedLog?.status])},n(p.statusText[p.selectedLog?.status]),3)])]),c(`div`,Ae,[l[72]||=c(`span`,{class:`detail-label`},`用户代理:`,-1),c(`span`,je,n(p.selectedLog?.userAgent),1)])]),c(`div`,Me,[l[73]||=c(`h4`,null,`详细数据`,-1),c(`pre`,null,n(p.formatJson(p.selectedLog?.details)),1)])]),c(`div`,Ne,[c(`button`,{class:`action-button primary`,onClick:l[21]||=(...e)=>p.closeDetailDialog&&p.closeDetailDialog(...e)},`关闭`)])])])):s(``,!0),p.showClearConfirm?(t(),i(`div`,{key:1,class:`dialog-overlay`,onClick:l[33]||=e=>p.showClearConfirm=!1},[c(`div`,{class:`dialog-content`,onClick:l[32]||=o(()=>{},[`stop`])},[c(`div`,Pe,[l[74]||=c(`h3`,null,`确认清空日志`,-1),c(`button`,{class:`close-button`,onClick:l[24]||=e=>p.showClearConfirm=!1},`×`)]),c(`div`,Fe,[l[79]||=c(`div`,{class:`warning-message`},[c(`span`,{class:`warning-icon`},`⚠️`),c(`p`,null,`清空日志操作将删除所有系统日志记录，此操作不可恢复！`)],-1),c(`div`,Ie,[c(`label`,null,[r(c(`input`,{type:`radio`,"onUpdate:modelValue":l[25]||=e=>p.clearOption=e,value:`all`},null,512),[[f,p.clearOption]]),l[75]||=y(` 清空所有日志 `,-1)]),c(`label`,null,[r(c(`input`,{type:`radio`,"onUpdate:modelValue":l[26]||=e=>p.clearOption=e,value:`older`},null,512),[[f,p.clearOption]]),l[76]||=y(` 清空指定日期之前的日志 `,-1),p.clearOption===`older`?r((t(),i(`input`,{key:0,type:`date`,"onUpdate:modelValue":l[27]||=e=>p.clearBeforeDate=e,class:`date-input`},null,512)),[[a,p.clearBeforeDate]]):s(``,!0)]),c(`label`,null,[r(c(`input`,{type:`radio`,"onUpdate:modelValue":l[28]||=e=>p.clearOption=e,value:`level`},null,512),[[f,p.clearOption]]),l[78]||=y(` 清空指定级别的日志 `,-1),p.clearOption===`level`?r((t(),i(`select`,{key:0,"onUpdate:modelValue":l[29]||=e=>p.clearLevel=e,class:`level-select`},[...l[77]||=[c(`option`,{value:`info`},`信息`,-1),c(`option`,{value:`warning`},`警告`,-1),c(`option`,{value:`error`},`错误`,-1),c(`option`,{value:`critical`},`严重`,-1)]],512)),[[g,p.clearLevel]]):s(``,!0)])])]),c(`div`,Le,[c(`button`,{class:`action-button`,onClick:l[30]||=e=>p.showClearConfirm=!1},`取消`),c(`button`,{class:`action-button danger`,onClick:l[31]||=(...e)=>p.confirmClearLogs&&p.confirmClearLogs(...e)},`确认清空`)])])])):s(``,!0)])}var ze=h(b,[[`render`,Re],[`__scopeId`,`data-v-37926d5b`]]);export{ze as default};