import{A as e,C as t,N as n,O as r,_ as i,c as a,d as o,f as s,g as c,h as l,j as u,m as d,o as f,p,s as m,u as h,v as g,w as _,x as ee,y as v}from"./index-D-ACJEW6.js";var y={name:`TeacherHoursDeduction`,setup(){let t=f(),n=e(``),r=e(``),i=e(``),a=e(!1),o=e(!1),s=e(null),c=e(1),l=e(``),u=e(``),p=e(``),m=e(``),h=e(1),g=e(``),_=e([]),v=e([{id:1,name:`数据结构`},{id:2,name:`算法分析`},{id:3,name:`数据库原理`},{id:4,name:`操作系统`},{id:5,name:`计算机网络`}]),y=e([{id:1,name:`张三`,studentId:`20210001`,courseId:1,courseName:`数据结构`,remainingHours:32,status:`active`},{id:2,name:`李四`,studentId:`20210002`,courseId:2,courseName:`算法分析`,remainingHours:28,status:`active`},{id:3,name:`王五`,studentId:`20210003`,courseId:1,courseName:`数据结构`,remainingHours:15,status:`active`},{id:4,name:`赵六`,studentId:`20210004`,courseId:3,courseName:`数据库原理`,remainingHours:40,status:`active`},{id:5,name:`钱七`,studentId:`20210005`,courseId:2,courseName:`算法分析`,remainingHours:5,status:`active`},{id:6,name:`孙八`,studentId:`20210006`,courseId:4,courseName:`操作系统`,remainingHours:25,status:`paused`},{id:7,name:`周九`,studentId:`20210007`,courseId:5,courseName:`计算机网络`,remainingHours:0,status:`expired`},{id:8,name:`吴十`,studentId:`20210008`,courseId:3,courseName:`数据库原理`,remainingHours:30,status:`active`}]),b=d(()=>y.value.filter(e=>{let t=e.name.toLowerCase().includes(n.value.toLowerCase())||e.studentId.includes(n.value),a=!r.value||e.courseId===parseInt(r.value),o=!i.value||e.status===i.value;return t&&a&&o})),x=e=>e<=5?`hours-low`:e<=15?`hours-medium`:`hours-normal`,S=()=>{p.value=``},C=()=>{},w=e=>{s.value=e,c.value=1,l.value=``,u.value=``,p.value=``,a.value=!0},T=()=>{a.value=!1,s.value=null,p.value=``},E=()=>{if(!c.value||c.value<=0){p.value=`请输入有效的扣除课时数`;return}if(!s.value){p.value=`未选择学生`;return}if(c.value>s.value.remainingHours){p.value=`扣除课时数不能大于剩余课时数`;return}if(!l.value){p.value=`请选择扣除原因`;return}let e=y.value.findIndex(e=>e.id===s.value.id);e!==-1&&(y.value[e].remainingHours-=c.value,y.value[e].remainingHours<=0&&(y.value[e].status=`expired`)),alert(`成功扣除 ${c.value} 课时`),T()},D=d(()=>c.value>0&&s.value&&c.value<=s.value.remainingHours&&!!l.value),O=e=>{t.push(`/home/teacher/students?id=${e}`)},k=()=>{_.value=[]},A=d(()=>m.value?y.value.filter(e=>e.courseId===parseInt(m.value)&&e.status===`active`):[]),j=()=>{_.value=A.value.map(e=>e.id)},M=()=>{_.value=[]},N=()=>{m.value=``,h.value=1,g.value=``,_.value=[],o.value=!0},P=()=>{o.value=!1},F=()=>{if(!m.value||!h.value||h.value<=0||!g.value||_.value.length===0){alert(`请填写完整信息并选择学生`);return}if(_.value.filter(e=>{let t=y.value.find(t=>t.id===e);return!t||t.remainingHours<h.value}).length>0){alert(`部分学生剩余课时不足，无法完成批量扣除`);return}_.value.forEach(e=>{let t=y.value.findIndex(t=>t.id===e);t!==-1&&(y.value[t].remainingHours-=h.value,y.value[t].remainingHours<=0&&(y.value[t].status=`expired`))}),alert(`成功批量扣除 ${_.value.length} 名学生的课时，每人 ${h.value} 课时`),P()},I=d(()=>m.value&&h.value>0&&g.value&&_.value.length>0);return ee(()=>{localStorage.getItem(`userToken`)||(localStorage.setItem(`userToken`,`mock-token-teacher-789`),localStorage.setItem(`userRole`,`teacher`))}),{searchQuery:n,selectedCourse:r,selectedStatus:i,filteredStudents:b,getHoursStatusClass:x,handleSearch:S,filterStudents:C,showDeductionModal:a,selectedStudent:s,deductionHours:c,deductionReason:l,deductionRemark:u,deductionError:p,canConfirmDeduction:D,openDeductionModal:w,closeDeductionModal:T,confirmDeduction:E,viewStudentDetails:O,showBatchModal:o,batchCourseId:m,batchDeductionHours:h,batchDeductionReason:g,selectedStudentsIds:_,courseStudents:A,canConfirmBatchDeduction:I,openBatchModal:N,closeBatchModal:P,confirmBatchDeduction:F,selectAllStudents:j,deselectAllStudents:M,loadCourseStudents:k,importAttendance:()=>{alert(`导入出勤记录功能开发中...`)},courses:v,goBack:()=>{t.push(`/home/teacher/dashboard`)}}}},b={class:`teacher-hours-deduction`},x={class:`page-header`},S={class:`deduction-container`},C={class:`search-filter`},w={class:`search-section`},T={class:`search-input`},E={class:`filter-section`},D=[`value`],O={class:`students-list`},k={class:`list-content`},A={class:`student-info`},j={class:`student-name`},M={class:`student-id`},N={class:`student-course`},P={class:`student-hours`},F={class:`student-actions`},I=[`onClick`],L=[`onClick`],R={key:0,class:`empty-state`},z={class:`batch-section`},B={class:`batch-actions`},V={class:`modal-header`},H={class:`modal-body`},U={class:`deduction-form`},W={class:`form-group`},G={class:`info-display`},K={class:`form-group`},q={class:`info-display`},J={class:`form-group`},Y={class:`info-display`},X={class:`form-group`},Z=[`max`],te={key:0,class:`error-message`},Q={class:`form-group`},ne={class:`form-group`},re={class:`modal-footer`},ie=[`disabled`],ae={class:`modal-header`},oe={class:`modal-body`},se={class:`batch-form`},ce={class:`form-group`},le=[`value`],ue={class:`form-group`},de={class:`form-group`},fe={class:`form-group`},pe={class:`students-selection`},$=[`id`,`value`],me=[`for`],he={class:`student-name`},ge={class:`student-hours`},_e={class:`selection-actions`},ve={class:`modal-footer`},ye=[`disabled`];function be(e,d,f,m,ee,y){return t(),i(`div`,b,[l(`div`,x,[l(`button`,{class:`back-button`,onClick:d[0]||=(...e)=>m.goBack&&m.goBack(...e)},`← 返回仪表盘`),d[29]||=l(`h2`,null,`课时扣除操作`,-1)]),l(`div`,S,[l(`div`,C,[l(`div`,w,[l(`div`,T,[r(l(`input`,{type:`text`,"onUpdate:modelValue":d[1]||=e=>m.searchQuery=e,onInput:d[2]||=(...e)=>m.handleSearch&&m.handleSearch(...e),placeholder:`搜索学生姓名或学号`},null,544),[[o,m.searchQuery]]),d[30]||=l(`span`,{class:`search-icon`},`🔍`,-1)])]),l(`div`,E,[r(l(`select`,{"onUpdate:modelValue":d[3]||=e=>m.selectedCourse=e,onChange:d[4]||=(...e)=>m.filterStudents&&m.filterStudents(...e)},[d[31]||=l(`option`,{value:``},`所有课程`,-1),(t(!0),i(p,null,_(m.courses,e=>(t(),i(`option`,{key:e.id,value:e.id},n(e.name),9,D))),128))],544),[[h,m.selectedCourse]]),r(l(`select`,{"onUpdate:modelValue":d[5]||=e=>m.selectedStatus=e,onChange:d[6]||=(...e)=>m.filterStudents&&m.filterStudents(...e)},[...d[32]||=[l(`option`,{value:``},`所有状态`,-1),l(`option`,{value:`active`},`正常`,-1),l(`option`,{value:`paused`},`已暂停`,-1),l(`option`,{value:`expired`},`已过期`,-1)]],544),[[h,m.selectedStatus]])])]),l(`div`,O,[d[34]||=g(`<div class="list-header" data-v-b64a6f18><div class="header-item" data-v-b64a6f18>学生信息</div><div class="header-item" data-v-b64a6f18>课程</div><div class="header-item" data-v-b64a6f18>剩余课时</div><div class="header-item" data-v-b64a6f18>操作</div></div>`,1),l(`div`,k,[(t(!0),i(p,null,_(m.filteredStudents,e=>(t(),i(`div`,{key:e.id,class:`student-item`},[l(`div`,A,[l(`div`,j,n(e.name),1),l(`div`,M,`学号: `+n(e.studentId),1)]),l(`div`,N,n(e.courseName),1),l(`div`,P,[l(`div`,{class:u([`hours-display`,m.getHoursStatusClass(e.remainingHours)])},n(e.remainingHours)+` 课时 `,3)]),l(`div`,F,[l(`button`,{class:`action-button small primary`,onClick:t=>m.openDeductionModal(e)},` 扣除课时 `,8,I),l(`button`,{class:`action-button small`,onClick:t=>m.viewStudentDetails(e.id)},` 查看详情 `,8,L)])]))),128))]),m.filteredStudents.length===0?(t(),i(`div`,R,[...d[33]||=[l(`p`,null,`没有找到匹配的学生`,-1)]])):c(``,!0)]),l(`div`,z,[d[35]||=l(`h3`,{class:`section-title`},`批量扣除课时`,-1),l(`div`,B,[l(`button`,{class:`action-button primary`,onClick:d[7]||=(...e)=>m.openBatchModal&&m.openBatchModal(...e)},`批量扣除`),l(`button`,{class:`action-button`,onClick:d[8]||=(...e)=>m.importAttendance&&m.importAttendance(...e)},`导入出勤记录`)])])]),m.showDeductionModal?(t(),i(`div`,{key:0,class:`modal-overlay`,onClick:d[16]||=(...e)=>m.closeDeductionModal&&m.closeDeductionModal(...e)},[l(`div`,{class:`modal-content`,onClick:d[15]||=s(()=>{},[`stop`])},[l(`div`,V,[l(`h3`,null,`扣除课时 - `+n(m.selectedStudent?.name),1),l(`button`,{class:`close-button`,onClick:d[9]||=(...e)=>m.closeDeductionModal&&m.closeDeductionModal(...e)},`×`)]),l(`div`,H,[l(`div`,U,[l(`div`,W,[d[36]||=l(`label`,null,`学生信息`,-1),l(`div`,G,[l(`span`,null,n(m.selectedStudent?.name),1),l(`span`,null,`(`+n(m.selectedStudent?.studentId)+`)`,1)])]),l(`div`,K,[d[37]||=l(`label`,null,`课程名称`,-1),l(`div`,q,n(m.selectedStudent?.courseName),1)]),l(`div`,J,[d[38]||=l(`label`,null,`当前剩余课时`,-1),l(`div`,Y,n(m.selectedStudent?.remainingHours)+` 课时`,1)]),l(`div`,X,[d[39]||=l(`label`,null,[v(`扣除课时数 `),l(`span`,{class:`required`},`*`)],-1),r(l(`input`,{type:`number`,"onUpdate:modelValue":d[10]||=e=>m.deductionHours=e,min:`1`,max:m.selectedStudent?.remainingHours,placeholder:`请输入扣除课时数`},null,8,Z),[[o,m.deductionHours,void 0,{number:!0}]]),m.deductionError?(t(),i(`div`,te,n(m.deductionError),1)):c(``,!0)]),l(`div`,Q,[d[41]||=l(`label`,null,[v(`扣除原因 `),l(`span`,{class:`required`},`*`)],-1),r(l(`select`,{"onUpdate:modelValue":d[11]||=e=>m.deductionReason=e},[...d[40]||=[g(`<option value="" data-v-b64a6f18>请选择扣除原因</option><option value="normal_class" data-v-b64a6f18>正常上课</option><option value="makeup_class" data-v-b64a6f18>补课</option><option value="special_training" data-v-b64a6f18>特训课程</option><option value="other" data-v-b64a6f18>其他原因</option>`,5)]],512),[[h,m.deductionReason]])]),l(`div`,ne,[d[42]||=l(`label`,null,`备注`,-1),r(l(`textarea`,{"onUpdate:modelValue":d[12]||=e=>m.deductionRemark=e,placeholder:`请输入备注信息（选填）`},null,512),[[o,m.deductionRemark]])])])]),l(`div`,re,[l(`button`,{class:`action-button`,onClick:d[13]||=(...e)=>m.closeDeductionModal&&m.closeDeductionModal(...e)},`取消`),l(`button`,{class:`action-button primary`,onClick:d[14]||=(...e)=>m.confirmDeduction&&m.confirmDeduction(...e),disabled:!m.canConfirmDeduction},` 确认扣除 `,8,ie)])])])):c(``,!0),m.showBatchModal?(t(),i(`div`,{key:1,class:`modal-overlay`,onClick:d[28]||=(...e)=>m.closeBatchModal&&m.closeBatchModal(...e)},[l(`div`,{class:`modal-content batch-modal`,onClick:d[27]||=s(()=>{},[`stop`])},[l(`div`,ae,[d[43]||=l(`h3`,null,`批量扣除课时`,-1),l(`button`,{class:`close-button`,onClick:d[17]||=(...e)=>m.closeBatchModal&&m.closeBatchModal(...e)},`×`)]),l(`div`,oe,[l(`div`,se,[l(`div`,ce,[d[45]||=l(`label`,null,[v(`选择课程 `),l(`span`,{class:`required`},`*`)],-1),r(l(`select`,{"onUpdate:modelValue":d[18]||=e=>m.batchCourseId=e,onChange:d[19]||=(...e)=>m.loadCourseStudents&&m.loadCourseStudents(...e)},[d[44]||=l(`option`,{value:``},`请选择课程`,-1),(t(!0),i(p,null,_(m.courses,e=>(t(),i(`option`,{key:e.id,value:e.id},n(e.name),9,le))),128))],544),[[h,m.batchCourseId]])]),l(`div`,ue,[d[46]||=l(`label`,null,[v(`扣除课时数 `),l(`span`,{class:`required`},`*`)],-1),r(l(`input`,{type:`number`,"onUpdate:modelValue":d[20]||=e=>m.batchDeductionHours=e,min:`1`,placeholder:`请输入扣除课时数`},null,512),[[o,m.batchDeductionHours,void 0,{number:!0}]])]),l(`div`,de,[d[48]||=l(`label`,null,[v(`扣除原因 `),l(`span`,{class:`required`},`*`)],-1),r(l(`select`,{"onUpdate:modelValue":d[21]||=e=>m.batchDeductionReason=e},[...d[47]||=[l(`option`,{value:``},`请选择扣除原因`,-1),l(`option`,{value:`normal_class`},`正常上课`,-1),l(`option`,{value:`makeup_class`},`补课`,-1),l(`option`,{value:`special_training`},`特训课程`,-1)]],512),[[h,m.batchDeductionReason]])]),l(`div`,fe,[d[49]||=l(`label`,null,`选择学生`,-1),l(`div`,pe,[(t(!0),i(p,null,_(m.courseStudents,e=>(t(),i(`div`,{key:e.id,class:`student-checkbox`},[r(l(`input`,{type:`checkbox`,id:`student-${e.id}`,value:e.id,"onUpdate:modelValue":d[22]||=e=>m.selectedStudentsIds=e},null,8,$),[[a,m.selectedStudentsIds]]),l(`label`,{for:`student-${e.id}`},[l(`span`,he,n(e.name),1),l(`span`,ge,`(剩余: `+n(e.remainingHours)+`课时)`,1)],8,me)]))),128))]),l(`div`,_e,[l(`button`,{class:`small-button`,onClick:d[23]||=(...e)=>m.selectAllStudents&&m.selectAllStudents(...e)},`全选`),l(`button`,{class:`small-button`,onClick:d[24]||=(...e)=>m.deselectAllStudents&&m.deselectAllStudents(...e)},`取消全选`)])])])]),l(`div`,ve,[l(`button`,{class:`action-button`,onClick:d[25]||=(...e)=>m.closeBatchModal&&m.closeBatchModal(...e)},`取消`),l(`button`,{class:`action-button primary`,onClick:d[26]||=(...e)=>m.confirmBatchDeduction&&m.confirmBatchDeduction(...e),disabled:!m.canConfirmBatchDeduction},` 确认批量扣除 `,8,ye)])])])):c(``,!0)])}var xe=m(y,[[`render`,be],[`__scopeId`,`data-v-b64a6f18`]]);export{xe as default};