# 课程管理系统数据库设计

## 1. 数据库设计概述

本数据库设计基于课程管理系统的业务需求，采用关系型数据库设计方法，确保数据的完整性、一致性和可扩展性。设计遵循规范化原则，同时考虑系统性能和实际业务需求。

### 1.1 设计原则
- **数据完整性**：通过主键、外键、约束等确保数据的准确性和一致性
- **规范化设计**：遵循数据库设计的三大范式，减少数据冗余
- **性能优化**：合理设计索引，优化查询性能
- **可扩展性**：支持系统功能的未来扩展
- **安全性**：敏感数据加密存储，完善的权限控制

### 1.2 技术选型
- **数据库系统**：MySQL 5.7+
- **字符集**：UTF8mb4（支持完整的UTF-8字符集，包括表情符号等）
- **存储引擎**：InnoDB（支持事务和外键约束）

## 2. 数据库表结构设计

### 2.1 用户相关表

#### 2.1.1 用户表（user）
```sql
CREATE TABLE `user` (
  `user_id` INT(11) PRIMARY KEY AUTO_INCREMENT COMMENT '用户ID',
  `username` VARCHAR(50) NOT NULL UNIQUE COMMENT '用户名',
  `password` VARCHAR(255) NOT NULL COMMENT '密码（加密存储）',
  `email` VARCHAR(100) UNIQUE COMMENT '邮箱',
  `phone` VARCHAR(20) COMMENT '手机号',
  `real_name` VARCHAR(50) COMMENT '真实姓名',
  `avatar` VARCHAR(255) COMMENT '头像URL',
  `last_login_time` TIMESTAMP COMMENT '最后登录时间',
  `last_login_ip` VARCHAR(50) COMMENT '最后登录IP',
  `status` TINYINT(4) DEFAULT 1 COMMENT '用户状态：0-禁用，1-启用',
  `create_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  INDEX idx_username (`username`),
  INDEX idx_email (`email`),
  INDEX idx_phone (`phone`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户表';
```

#### 2.1.2 角色表（role）
```sql
CREATE TABLE `role` (
  `role_id` INT(11) PRIMARY KEY AUTO_INCREMENT COMMENT '角色ID',
  `role_name` VARCHAR(50) NOT NULL UNIQUE COMMENT '角色名称',
  `description` TEXT COMMENT '角色描述',
  `create_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  INDEX idx_role_name (`role_name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='角色表';
```

#### 2.1.3 权限表（permission）
```sql
CREATE TABLE `permission` (
  `permission_id` INT(11) PRIMARY KEY AUTO_INCREMENT COMMENT '权限ID',
  `permission_code` VARCHAR(50) NOT NULL UNIQUE COMMENT '权限编码',
  `permission_name` VARCHAR(100) NOT NULL COMMENT '权限名称',
  `module` VARCHAR(50) NOT NULL COMMENT '所属模块',
  `operation` VARCHAR(50) COMMENT '操作类型：add, edit, delete, view',
  `description` TEXT COMMENT '权限描述',
  `create_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  INDEX idx_permission_code (`permission_code`),
  INDEX idx_module (`module`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='权限表';
```

#### 2.1.4 用户-角色关联表（user_role）
```sql
CREATE TABLE `user_role` (
  `id` INT(11) PRIMARY KEY AUTO_INCREMENT COMMENT '主键ID',
  `user_id` INT(11) NOT NULL COMMENT '用户ID',
  `role_id` INT(11) NOT NULL COMMENT '角色ID',
  `create_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  UNIQUE KEY uk_user_role (`user_id`, `role_id`),
  INDEX idx_user_id (`user_id`),
  INDEX idx_role_id (`role_id`),
  FOREIGN KEY (`user_id`) REFERENCES `user` (`user_id`) ON DELETE CASCADE,
  FOREIGN KEY (`role_id`) REFERENCES `role` (`role_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户-角色关联表';
```

#### 2.1.5 角色-权限关联表（role_permission）
```sql
CREATE TABLE `role_permission` (
  `id` INT(11) PRIMARY KEY AUTO_INCREMENT COMMENT '主键ID',
  `role_id` INT(11) NOT NULL COMMENT '角色ID',
  `permission_id` INT(11) NOT NULL COMMENT '权限ID',
  `create_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  UNIQUE KEY uk_role_permission (`role_id`, `permission_id`),
  INDEX idx_role_id (`role_id`),
  INDEX idx_permission_id (`permission_id`),
  FOREIGN KEY (`role_id`) REFERENCES `role` (`role_id`) ON DELETE CASCADE,
  FOREIGN KEY (`permission_id`) REFERENCES `permission` (`permission_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='角色-权限关联表';
```

#### 2.1.6 权限组表（permission_group）
```sql
CREATE TABLE `permission_group` (
  `group_id` INT(11) PRIMARY KEY AUTO_INCREMENT COMMENT '权限组ID',
  `group_name` VARCHAR(100) NOT NULL COMMENT '权限组名称',
  `description` TEXT COMMENT '权限组描述',
  `create_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  INDEX idx_group_name (`group_name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='权限组表';
```

#### 2.1.7 权限组-权限关联表（group_permission）
```sql
CREATE TABLE `group_permission` (
  `id` INT(11) PRIMARY KEY AUTO_INCREMENT COMMENT '主键ID',
  `group_id` INT(11) NOT NULL COMMENT '权限组ID',
  `permission_id` INT(11) NOT NULL COMMENT '权限ID',
  `create_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  UNIQUE KEY uk_group_permission (`group_id`, `permission_id`),
  INDEX idx_group_id (`group_id`),
  INDEX idx_permission_id (`permission_id`),
  FOREIGN KEY (`group_id`) REFERENCES `permission_group` (`group_id`) ON DELETE CASCADE,
  FOREIGN KEY (`permission_id`) REFERENCES `permission` (`permission_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='权限组-权限关联表';
```

### 2.2 教师相关表

#### 2.2.1 教师表（teacher）
```sql
CREATE TABLE `teacher` (
  `teacher_id` INT(11) PRIMARY KEY AUTO_INCREMENT COMMENT '教师ID',
  `user_id` INT(11) UNIQUE COMMENT '关联用户ID',
  `teacher_no` VARCHAR(50) NOT NULL UNIQUE COMMENT '教师编号',
  `name` VARCHAR(50) NOT NULL COMMENT '教师姓名',
  `gender` VARCHAR(10) COMMENT '性别',
  `birthday` DATE COMMENT '出生日期',
  `phone` VARCHAR(20) COMMENT '手机号码',
  `email` VARCHAR(100) COMMENT '电子邮箱',
  `address` VARCHAR(255) COMMENT '家庭地址',
  `hire_date` DATE COMMENT '入职日期',
  `position` VARCHAR(50) COMMENT '职位',
  `department` VARCHAR(100) COMMENT '所属部门',
  `qualification` VARCHAR(100) COMMENT '资格证书',
  `specialty` VARCHAR(100) COMMENT '专业特长',
  `status` VARCHAR(20) DEFAULT 'active' COMMENT '状态：active-在职，inactive-离职，suspended-暂停',
  `create_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  INDEX idx_teacher_no (`teacher_no`),
  INDEX idx_name (`name`),
  INDEX idx_phone (`phone`),
  INDEX idx_email (`email`),
  FOREIGN KEY (`user_id`) REFERENCES `user` (`user_id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='教师表';
```

### 2.3 学生相关表

#### 2.3.1 学生表（student）
```sql
CREATE TABLE `student` (
  `student_id` INT(11) PRIMARY KEY AUTO_INCREMENT COMMENT '学生ID',
  `user_id` INT(11) UNIQUE COMMENT '关联用户ID',
  `student_no` VARCHAR(50) NOT NULL UNIQUE COMMENT '学号',
  `name` VARCHAR(50) NOT NULL COMMENT '学生姓名',
  `gender` VARCHAR(10) COMMENT '性别',
  `birthday` DATE COMMENT '出生日期',
  `phone` VARCHAR(20) COMMENT '手机号码',
  `email` VARCHAR(100) COMMENT '电子邮箱',
  `address` VARCHAR(255) COMMENT '家庭地址',
  `enrollment_date` DATE COMMENT '入学日期',
  `parent_name` VARCHAR(50) COMMENT '家长姓名',
  `parent_phone` VARCHAR(20) COMMENT '家长联系电话',
  `status` VARCHAR(20) DEFAULT 'active' COMMENT '状态：active-在读，graduated-毕业，dropped-退学',
  `create_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  INDEX idx_student_no (`student_no`),
  INDEX idx_name (`name`),
  INDEX idx_phone (`phone`),
  INDEX idx_email (`email`),
  FOREIGN KEY (`user_id`) REFERENCES `user` (`user_id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='学生表';
```

### 2.4 课程相关表

#### 2.4.1 课程表（course）
```sql
CREATE TABLE `course` (
  `course_id` INT(11) PRIMARY KEY AUTO_INCREMENT COMMENT '课程ID',
  `course_name` VARCHAR(100) NOT NULL COMMENT '课程名称',
  `description` TEXT COMMENT '课程描述',
  `credit` INT(11) COMMENT '学分',
  `total_hours` INT(11) NOT NULL COMMENT '总课时',
  `start_date` DATE COMMENT '开始日期',
  `end_date` DATE COMMENT '结束日期',
  `level` VARCHAR(50) COMMENT '难度级别',
  `category` VARCHAR(100) COMMENT '课程分类',
  `target_audience` VARCHAR(255) COMMENT '适用对象',
  `teaching_method` VARCHAR(255) COMMENT '教学方式',
  `status` VARCHAR(20) DEFAULT 'draft' COMMENT '状态：draft-草稿，published-已发布，ended-已结束',
  `created_by` INT(11) COMMENT '创建人ID',
  `create_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  INDEX idx_course_name (`course_name`),
  INDEX idx_category (`category`),
  INDEX idx_status (`status`),
  INDEX idx_created_by (`created_by`),
  FOREIGN KEY (`created_by`) REFERENCES `user` (`user_id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='课程表';
```

#### 2.4.2 课程大纲表（course_syllabus）
```sql
CREATE TABLE `course_syllabus` (
  `syllabus_id` INT(11) PRIMARY KEY AUTO_INCREMENT COMMENT '大纲ID',
  `course_id` INT(11) NOT NULL COMMENT '课程ID',
  `chapter_title` VARCHAR(255) NOT NULL COMMENT '章节标题',
  `chapter_no` INT(11) NOT NULL COMMENT '章节序号',
  `content` TEXT COMMENT '章节内容',
  `hours` DECIMAL(5,1) COMMENT '章节课时',
  `create_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  INDEX idx_course_id (`course_id`),
  INDEX idx_chapter_no (`chapter_no`),
  FOREIGN KEY (`course_id`) REFERENCES `course` (`course_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='课程大纲表';
```

#### 2.4.3 课程教材表（course_material）
```sql
CREATE TABLE `course_material` (
  `material_id` INT(11) PRIMARY KEY AUTO_INCREMENT COMMENT '教材ID',
  `course_id` INT(11) NOT NULL COMMENT '课程ID',
  `title` VARCHAR(255) NOT NULL COMMENT '教材名称',
  `author` VARCHAR(100) COMMENT '作者',
  `publisher` VARCHAR(100) COMMENT '出版社',
  `isbn` VARCHAR(50) COMMENT 'ISBN号',
  `required_type` VARCHAR(20) DEFAULT 'required' COMMENT '类型：required-必选，recommended-推荐',
  `create_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  INDEX idx_course_id (`course_id`),
  INDEX idx_title (`title`),
  INDEX idx_isbn (`isbn`),
  FOREIGN KEY (`course_id`) REFERENCES `course` (`course_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='课程教材表';
```

### 2.5 班级相关表

#### 2.5.1 班级表（class）
```sql
CREATE TABLE `class` (
  `class_id` INT(11) PRIMARY KEY AUTO_INCREMENT COMMENT '班级ID',
  `class_name` VARCHAR(100) NOT NULL COMMENT '班级名称',
  `grade` VARCHAR(50) COMMENT '年级',
  `head_teacher_id` INT(11) COMMENT '班主任ID',
  `start_date` DATE COMMENT '开班日期',
  `end_date` DATE COMMENT '毕业日期',
  `max_students` INT(11) COMMENT '最大学生数',
  `current_students` INT(11) DEFAULT 0 COMMENT '当前学生数',
  `status` VARCHAR(20) DEFAULT 'active' COMMENT '状态：active-在读，graduated-已毕业，closed-已关闭',
  `create_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  INDEX idx_class_name (`class_name`),
  INDEX idx_head_teacher_id (`head_teacher_id`),
  INDEX idx_status (`status`),
  FOREIGN KEY (`head_teacher_id`) REFERENCES `teacher` (`teacher_id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='班级表';
```

#### 2.5.2 学生-班级关联表（student_class）
```sql
CREATE TABLE `student_class` (
  `id` INT(11) PRIMARY KEY AUTO_INCREMENT COMMENT '主键ID',
  `student_id` INT(11) NOT NULL COMMENT '学生ID',
  `class_id` INT(11) NOT NULL COMMENT '班级ID',
  `join_date` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '加入日期',
  `leave_date` DATE COMMENT '离开日期',
  `status` VARCHAR(20) DEFAULT 'active' COMMENT '状态：active-在读，transferred-转学，graduated-毕业，dropped-退学',
  UNIQUE KEY uk_student_class (`student_id`, `class_id`),
  INDEX idx_student_id (`student_id`),
  INDEX idx_class_id (`class_id`),
  INDEX idx_status (`status`),
  FOREIGN KEY (`student_id`) REFERENCES `student` (`student_id`) ON DELETE CASCADE,
  FOREIGN KEY (`class_id`) REFERENCES `class` (`class_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='学生-班级关联表';
```

### 2.6 排课相关表

#### 2.6.1 教室表（classroom）
```sql
CREATE TABLE `classroom` (
  `classroom_id` INT(11) PRIMARY KEY AUTO_INCREMENT COMMENT '教室ID',
  `room_no` VARCHAR(50) NOT NULL UNIQUE COMMENT '教室编号',
  `capacity` INT(11) NOT NULL COMMENT '容量',
  `location` VARCHAR(255) COMMENT '位置',
  `equipment` TEXT COMMENT '设备情况',
  `floor` INT(11) COMMENT '楼层',
  `building` VARCHAR(100) COMMENT '楼栋',
  `room_type` VARCHAR(50) COMMENT '教室类型：classroom-普通教室，lab-实验室，computer-电脑教室，meeting-会议室',
  `has_projector` TINYINT(4) DEFAULT 0 COMMENT '是否有投影仪：0-否，1-是',
  `has_whiteboard` TINYINT(4) DEFAULT 0 COMMENT '是否有白板：0-否，1-是',
  `has_wifi` TINYINT(4) DEFAULT 0 COMMENT '是否有WiFi：0-否，1-是',
  `status` VARCHAR(20) DEFAULT 'available' COMMENT '状态：available-可用，maintenance-维护中，unavailable-不可用',
  `last_maintenance_date` DATE COMMENT '最后维护日期',
  `create_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  INDEX idx_room_no (`room_no`),
  INDEX idx_status (`status`),
  INDEX idx_room_type (`room_type`),
  INDEX idx_floor (`floor`),
  INDEX idx_building (`building`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='教室表';
```

#### 2.6.2 排课表（schedule）
```sql
CREATE TABLE `schedule` (
  `schedule_id` INT(11) PRIMARY KEY AUTO_INCREMENT COMMENT '排课ID',
  `course_id` INT(11) NOT NULL COMMENT '课程ID',
  `teacher_id` INT(11) NOT NULL COMMENT '教师ID',
  `class_id` INT(11) COMMENT '班级ID',
  `classroom_id` INT(11) NOT NULL COMMENT '教室ID',
  `start_time` DATETIME NOT NULL COMMENT '开始时间',
  `end_time` DATETIME NOT NULL COMMENT '结束时间',
  `day_of_week` INT(11) COMMENT '星期几（1-7）',
  `week_no` INT(11) COMMENT '周次',
  `total_weeks` INT(11) COMMENT '总周数',
  `hours` DECIMAL(5,1) NOT NULL COMMENT '课时数',
  `schedule_type` VARCHAR(20) DEFAULT 'regular' COMMENT '排课类型：regular-常规课，makeup-补课，trial-试听',
  `attendance_required` TINYINT(4) DEFAULT 1 COMMENT '是否需要签到：0-否，1-是',
  `auto_deduct` TINYINT(4) DEFAULT 1 COMMENT '是否自动扣课：0-否，1-是',
  `max_students` INT(11) COMMENT '最大学生数',
  `current_students` INT(11) DEFAULT 0 COMMENT '当前学生数',
  `status` VARCHAR(20) DEFAULT 'scheduled' COMMENT '状态：scheduled-已排课，completed-已完成，canceled-已取消，rescheduled-已调课',
  `cancel_reason` TEXT COMMENT '取消原因',
  `original_schedule_id` INT(11) COMMENT '原排课ID（调课时使用）',
  `remark` TEXT COMMENT '备注',
  `create_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  INDEX idx_course_id (`course_id`),
  INDEX idx_teacher_id (`teacher_id`),
  INDEX idx_class_id (`class_id`),
  INDEX idx_classroom_id (`classroom_id`),
  INDEX idx_start_time (`start_time`),
  INDEX idx_end_time (`end_time`),
  INDEX idx_status (`status`),
  INDEX idx_schedule_type (`schedule_type`),
  INDEX idx_day_of_week (`day_of_week`),
  INDEX idx_week_no (`week_no`),
  INDEX idx_original_schedule (`original_schedule_id`),
  FOREIGN KEY (`course_id`) REFERENCES `course` (`course_id`) ON DELETE CASCADE,
  FOREIGN KEY (`teacher_id`) REFERENCES `teacher` (`teacher_id`) ON DELETE CASCADE,
  FOREIGN KEY (`class_id`) REFERENCES `class` (`class_id`) ON DELETE SET NULL,
  FOREIGN KEY (`classroom_id`) REFERENCES `classroom` (`classroom_id`) ON DELETE CASCADE,
  FOREIGN KEY (`original_schedule_id`) REFERENCES `schedule` (`schedule_id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='排课表';
```

#### 2.6.3 教室使用状态表（classroom_status_log）
```sql
CREATE TABLE `classroom_status_log` (
  `log_id` INT(11) PRIMARY KEY AUTO_INCREMENT COMMENT '日志ID',
  `classroom_id` INT(11) NOT NULL COMMENT '教室ID',
  `schedule_id` INT(11) COMMENT '关联排课ID',
  `start_time` DATETIME NOT NULL COMMENT '开始时间',
  `end_time` DATETIME NOT NULL COMMENT '结束时间',
  `status` VARCHAR(20) NOT NULL COMMENT '状态：booked-已预订，in_use-使用中，available-可用，maintenance-维护中',
  `description` VARCHAR(255) COMMENT '描述',
  `created_by` INT(11) COMMENT '创建人',
  `create_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  INDEX idx_classroom_id (`classroom_id`),
  INDEX idx_schedule_id (`schedule_id`),
  INDEX idx_start_time (`start_time`),
  INDEX idx_end_time (`end_time`),
  INDEX idx_status (`status`),
  INDEX idx_created_by (`created_by`),
  FOREIGN KEY (`classroom_id`) REFERENCES `classroom` (`classroom_id`) ON DELETE CASCADE,
  FOREIGN KEY (`schedule_id`) REFERENCES `schedule` (`schedule_id`) ON DELETE CASCADE,
  FOREIGN KEY (`created_by`) REFERENCES `user` (`user_id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='教室使用状态表';
```

### 2.7 学生选课相关表

#### 2.7.1 学生-课程关联表（student_course）
```sql
CREATE TABLE `student_course` (
  `id` INT(11) PRIMARY KEY AUTO_INCREMENT COMMENT '主键ID',
  `student_id` INT(11) NOT NULL COMMENT '学生ID',
  `course_id` INT(11) NOT NULL COMMENT '课程ID',
  `enrollment_date` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '报名日期',
  `total_hours` DECIMAL(5,1) DEFAULT 0 COMMENT '总课时',
  `remaining_hours` DECIMAL(5,1) DEFAULT 0 COMMENT '剩余课时',
  `used_hours` DECIMAL(5,1) DEFAULT 0 COMMENT '已使用课时',
  `last_deduction_time` TIMESTAMP COMMENT '最后扣课时间',
  `auto_deduct_flag` TINYINT(4) DEFAULT 1 COMMENT '是否自动扣课：0-否，1-是',
  `status` VARCHAR(20) DEFAULT 'enrolled' COMMENT '状态：enrolled-已报名，completed-已完成，dropped-已退课，paused-已暂停',
  UNIQUE KEY uk_student_course (`student_id`, `course_id`),
  INDEX idx_student_id (`student_id`),
  INDEX idx_course_id (`course_id`),
  INDEX idx_status (`status`),
  INDEX idx_last_deduction (`last_deduction_time`),
  FOREIGN KEY (`student_id`) REFERENCES `student` (`student_id`) ON DELETE CASCADE,
  FOREIGN KEY (`course_id`) REFERENCES `course` (`course_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='学生-课程关联表';
```

#### 2.7.2 课时记录表（course_hours_record）
```sql
CREATE TABLE `course_hours_record` (
  `record_id` INT(11) PRIMARY KEY AUTO_INCREMENT COMMENT '记录ID',
  `student_id` INT(11) NOT NULL COMMENT '学生ID',
  `course_id` INT(11) NOT NULL COMMENT '课程ID',
  `teacher_id` INT(11) NOT NULL COMMENT '教师ID',
  `schedule_id` INT(11) COMMENT '关联排课ID',
  `hours` DECIMAL(5,1) NOT NULL COMMENT '课时数量',
  `record_type` VARCHAR(20) NOT NULL COMMENT '记录类型：deduction-扣课，addition-加课，adjustment-调整',
  `record_date` DATE NOT NULL COMMENT '记录日期',
  `class_start_time` DATETIME COMMENT '上课开始时间',
  `class_end_time` DATETIME COMMENT '上课结束时间',
  `classroom_id` INT(11) COMMENT '教室ID',
  `record_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '录入时间',
  `recorded_by` INT(11) COMMENT '录入人',
  `reason` VARCHAR(255) COMMENT '原因',
  `remark` VARCHAR(255) COMMENT '备注',
  INDEX idx_student_id (`student_id`),
  INDEX idx_course_id (`course_id`),
  INDEX idx_teacher_id (`teacher_id`),
  INDEX idx_schedule_id (`schedule_id`),
  INDEX idx_record_date (`record_date`),
  INDEX idx_record_type (`record_type`),
  INDEX idx_recorded_by (`recorded_by`),
  FOREIGN KEY (`student_id`) REFERENCES `student` (`student_id`) ON DELETE CASCADE,
  FOREIGN KEY (`course_id`) REFERENCES `course` (`course_id`) ON DELETE CASCADE,
  FOREIGN KEY (`teacher_id`) REFERENCES `teacher` (`teacher_id`) ON DELETE CASCADE,
  FOREIGN KEY (`schedule_id`) REFERENCES `schedule` (`schedule_id`) ON DELETE SET NULL,
  FOREIGN KEY (`classroom_id`) REFERENCES `classroom` (`classroom_id`) ON DELETE SET NULL,
  FOREIGN KEY (`recorded_by`) REFERENCES `user` (`user_id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='课时记录表';
```

#### 2.7.3 上课记录表（class_record）
```sql
CREATE TABLE `class_record` (
  `class_record_id` INT(11) PRIMARY KEY AUTO_INCREMENT COMMENT '上课记录ID',
  `schedule_id` INT(11) NOT NULL COMMENT '排课ID',
  `teacher_id` INT(11) NOT NULL COMMENT '教师ID',
  `classroom_id` INT(11) NOT NULL COMMENT '教室ID',
  `actual_start_time` DATETIME COMMENT '实际开始时间',
  `actual_end_time` DATETIME COMMENT '实际结束时间',
  `teaching_content` TEXT COMMENT '教学内容',
  `teaching_summary` TEXT COMMENT '教学总结',
  `homework` TEXT COMMENT '作业布置',
  `attendance_count` INT(11) DEFAULT 0 COMMENT '出勤人数',
  `late_count` INT(11) DEFAULT 0 COMMENT '迟到人数',
  `absent_count` INT(11) DEFAULT 0 COMMENT '缺勤人数',
  `leave_early_count` INT(11) DEFAULT 0 COMMENT '早退人数',
  `status` VARCHAR(20) DEFAULT 'pending' COMMENT '状态：pending-待记录，completed-已完成，canceled-已取消',
  `created_by` INT(11) COMMENT '创建人',
  `create_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  INDEX idx_schedule_id (`schedule_id`),
  INDEX idx_teacher_id (`teacher_id`),
  INDEX idx_classroom_id (`classroom_id`),
  INDEX idx_status (`status`),
  INDEX idx_actual_start_time (`actual_start_time`),
  INDEX idx_created_by (`created_by`),
  FOREIGN KEY (`schedule_id`) REFERENCES `schedule` (`schedule_id`) ON DELETE CASCADE,
  FOREIGN KEY (`teacher_id`) REFERENCES `teacher` (`teacher_id`) ON DELETE CASCADE,
  FOREIGN KEY (`classroom_id`) REFERENCES `classroom` (`classroom_id`) ON DELETE CASCADE,
  FOREIGN KEY (`created_by`) REFERENCES `user` (`user_id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='上课记录表';
```

#### 2.7.4 学生上课档案表（student_class_archive）
```sql
CREATE TABLE `student_class_archive` (
  `archive_id` INT(11) PRIMARY KEY AUTO_INCREMENT COMMENT '档案ID',
  `student_id` INT(11) NOT NULL COMMENT '学生ID',
  `course_id` INT(11) NOT NULL COMMENT '课程ID',
  `schedule_id` INT(11) NOT NULL COMMENT '排课ID',
  `class_record_id` INT(11) COMMENT '上课记录ID',
  `teacher_id` INT(11) NOT NULL COMMENT '教师ID',
  `classroom_id` INT(11) NOT NULL COMMENT '教室ID',
  `class_date` DATE NOT NULL COMMENT '上课日期',
  `class_start_time` DATETIME NOT NULL COMMENT '上课开始时间',
  `class_end_time` DATETIME NOT NULL COMMENT '上课结束时间',
  `attendance_status` VARCHAR(20) NOT NULL COMMENT '出勤状态：present-出勤，late-迟到，early_leave-早退，absent-缺勤',
  `hours_deducted` DECIMAL(5,1) DEFAULT 0 COMMENT '扣减课时',
  `learning_behavior` TEXT COMMENT '学习表现',
  `teacher_comment` TEXT COMMENT '教师评语',
  `parent_feedback` TEXT COMMENT '家长反馈',
  `create_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  INDEX idx_student_id (`student_id`),
  INDEX idx_course_id (`course_id`),
  INDEX idx_schedule_id (`schedule_id`),
  INDEX idx_class_record_id (`class_record_id`),
  INDEX idx_teacher_id (`teacher_id`),
  INDEX idx_class_date (`class_date`),
  INDEX idx_attendance_status (`attendance_status`),
  FOREIGN KEY (`student_id`) REFERENCES `student` (`student_id`) ON DELETE CASCADE,
  FOREIGN KEY (`course_id`) REFERENCES `course` (`course_id`) ON DELETE CASCADE,
  FOREIGN KEY (`schedule_id`) REFERENCES `schedule` (`schedule_id`) ON DELETE CASCADE,
  FOREIGN KEY (`class_record_id`) REFERENCES `class_record` (`class_record_id`) ON DELETE SET NULL,
  FOREIGN KEY (`teacher_id`) REFERENCES `teacher` (`teacher_id`) ON DELETE CASCADE,
  FOREIGN KEY (`classroom_id`) REFERENCES `classroom` (`classroom_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='学生上课档案表';
```

### 2.8 签到相关表

#### 2.8.1 签到记录表（attendance）
```sql
CREATE TABLE `attendance` (
  `attendance_id` INT(11) PRIMARY KEY AUTO_INCREMENT COMMENT '签到记录ID',
  `schedule_id` INT(11) NOT NULL COMMENT '排课ID',
  `student_id` INT(11) NOT NULL COMMENT '学生ID',
  `attendance_time` TIMESTAMP COMMENT '签到时间',
  `leave_time` TIMESTAMP COMMENT '签退时间',
  `attendance_type` VARCHAR(20) COMMENT '签到方式：qr_code-二维码，face-人脸识别，manual-手动，location-定位，password-密码',
  `leave_type` VARCHAR(20) COMMENT '签退方式：qr_code-二维码，face-人脸识别，manual-手动，location-定位',
  `status` VARCHAR(20) NOT NULL COMMENT '状态：present-出勤，late-迟到，early_leave-早退，absent-缺勤',
  `late_minutes` INT(11) DEFAULT 0 COMMENT '迟到分钟数',
  `early_leave_minutes` INT(11) DEFAULT 0 COMMENT '早退分钟数',
  `ip_address` VARCHAR(50) COMMENT '签到IP地址',
  `location` VARCHAR(255) COMMENT '签到位置',
  `device_info` VARCHAR(255) COMMENT '设备信息',
  `password` VARCHAR(50) COMMENT '签到密码（加密存储）',
  `remark` VARCHAR(255) COMMENT '备注',
  INDEX idx_schedule_id (`schedule_id`),
  INDEX idx_student_id (`student_id`),
  INDEX idx_attendance_time (`attendance_time`),
  INDEX idx_leave_time (`leave_time`),
  INDEX idx_status (`status`),
  INDEX idx_attendance_type (`attendance_type`),
  FOREIGN KEY (`schedule_id`) REFERENCES `schedule` (`schedule_id`) ON DELETE CASCADE,
  FOREIGN KEY (`student_id`) REFERENCES `student` (`student_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='签到记录表';
```

#### 2.8.2 扣课规则表（deduction_rule）
```sql
CREATE TABLE `deduction_rule` (
  `rule_id` INT(11) PRIMARY KEY AUTO_INCREMENT COMMENT '规则ID',
  `rule_name` VARCHAR(100) NOT NULL COMMENT '规则名称',
  `rule_type` VARCHAR(50) NOT NULL COMMENT '规则类型：attendance_based-基于出勤，schedule_based-基于排课',
  `attendance_status` VARCHAR(20) COMMENT '出勤状态（rule_type=attendance_based时有效）',
  `deduction_ratio` DECIMAL(5,2) DEFAULT 1.00 COMMENT '扣减比例',
  `min_hours` DECIMAL(5,1) DEFAULT 0.5 COMMENT '最小扣减课时',
  `max_hours` DECIMAL(5,1) DEFAULT 3.0 COMMENT '最大扣减课时',
  `is_active` TINYINT(4) DEFAULT 1 COMMENT '是否启用：0-否，1-是',
  `priority` INT(11) DEFAULT 10 COMMENT '优先级（数字越小优先级越高）',
  `description` TEXT COMMENT '规则描述',
  `create_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  INDEX idx_rule_type (`rule_type`),
  INDEX idx_attendance_status (`attendance_status`),
  INDEX idx_is_active (`is_active`),
  INDEX idx_priority (`priority`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='扣课规则表';
```

#### 2.8.3 排课-学生关联表（schedule_student）
```sql
CREATE TABLE `schedule_student` (
  `id` INT(11) PRIMARY KEY AUTO_INCREMENT COMMENT '主键ID',
  `schedule_id` INT(11) NOT NULL COMMENT '排课ID',
  `student_id` INT(11) NOT NULL COMMENT '学生ID',
  `course_id` INT(11) NOT NULL COMMENT '课程ID',
  `join_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '加入时间',
  `status` VARCHAR(20) DEFAULT 'active' COMMENT '状态：active-有效，removed-已移除，canceled-已取消',
  `auto_deduct_flag` TINYINT(4) DEFAULT 1 COMMENT '是否自动扣课：0-否，1-是',
  UNIQUE KEY uk_schedule_student (`schedule_id`, `student_id`),
  INDEX idx_schedule_id (`schedule_id`),
  INDEX idx_student_id (`student_id`),
  INDEX idx_course_id (`course_id`),
  INDEX idx_status (`status`),
  FOREIGN KEY (`schedule_id`) REFERENCES `schedule` (`schedule_id`) ON DELETE CASCADE,
  FOREIGN KEY (`student_id`) REFERENCES `student` (`student_id`) ON DELETE CASCADE,
  FOREIGN KEY (`course_id`) REFERENCES `course` (`course_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='排课-学生关联表';
```

### 2.9 订单相关表

#### 2.9.1 订单表（orders）
```sql
CREATE TABLE `orders` (
  `order_id` INT(11) PRIMARY KEY AUTO_INCREMENT COMMENT '订单ID',
  `student_id` INT(11) NOT NULL COMMENT '学生ID',
  `order_no` VARCHAR(50) NOT NULL UNIQUE COMMENT '订单编号',
  `amount` DECIMAL(10, 2) NOT NULL COMMENT '订单金额',
  `discount` DECIMAL(10, 2) DEFAULT 0 COMMENT '优惠金额',
  `actual_amount` DECIMAL(10, 2) NOT NULL COMMENT '实际支付金额',
  `status` VARCHAR(20) DEFAULT 'pending' COMMENT '状态：pending-待支付，paid-已支付，canceled-已取消，refunded-已退款',
  `payment_method` VARCHAR(50) COMMENT '支付方式：cash-现金，alipay-支付宝，wechat-微信支付，bank-银行转账',
  `payment_time` TIMESTAMP COMMENT '支付时间',
  `remark` TEXT COMMENT '订单备注',
  `created_by` INT(11) COMMENT '创建人',
  `create_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  INDEX idx_student_id (`student_id`),
  INDEX idx_order_no (`order_no`),
  INDEX idx_status (`status`),
  INDEX idx_payment_time (`payment_time`),
  INDEX idx_created_by (`created_by`),
  FOREIGN KEY (`student_id`) REFERENCES `student` (`student_id`) ON DELETE CASCADE,
  FOREIGN KEY (`created_by`) REFERENCES `user` (`user_id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='订单表';
```

#### 2.9.2 订单详情表（order_item）
```sql
CREATE TABLE `order_item` (
  `item_id` INT(11) PRIMARY KEY AUTO_INCREMENT COMMENT '订单详情ID',
  `order_id` INT(11) NOT NULL COMMENT '订单ID',
  `course_id` INT(11) NOT NULL COMMENT '课程ID',
  `quantity` INT(11) DEFAULT 1 COMMENT '数量',
  `unit_price` DECIMAL(10, 2) NOT NULL COMMENT '单价',
  `total_price` DECIMAL(10, 2) NOT NULL COMMENT '总价',
  INDEX idx_order_id (`order_id`),
  INDEX idx_course_id (`course_id`),
  FOREIGN KEY (`order_id`) REFERENCES `orders` (`order_id`) ON DELETE CASCADE,
  FOREIGN KEY (`course_id`) REFERENCES `course` (`course_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='订单详情表';
```

#### 2.9.3 发票表（invoice）
```sql
CREATE TABLE `invoice` (
  `invoice_id` INT(11) PRIMARY KEY AUTO_INCREMENT COMMENT '发票ID',
  `order_id` INT(11) NOT NULL COMMENT '订单ID',
  `invoice_no` VARCHAR(50) NOT NULL UNIQUE COMMENT '发票号码',
  `invoice_type` VARCHAR(20) COMMENT '发票类型：normal-普通发票，special-专用发票',
  `amount` DECIMAL(10, 2) NOT NULL COMMENT '发票金额',
  `title` VARCHAR(255) NOT NULL COMMENT '发票抬头',
  `tax_no` VARCHAR(50) COMMENT '税号',
  `issue_date` DATE COMMENT '开票日期',
  `status` VARCHAR(20) DEFAULT 'unissued' COMMENT '状态：unissued-未开票，issued-已开票，cancelled-已作废',
  `remark` TEXT COMMENT '备注',
  INDEX idx_order_id (`order_id`),
  INDEX idx_invoice_no (`invoice_no`),
  INDEX idx_status (`status`),
  FOREIGN KEY (`order_id`) REFERENCES `orders` (`order_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='发票表';
```

#### 2.9.4 退款记录表（refund_record）
```sql
CREATE TABLE `refund_record` (
  `refund_id` INT(11) PRIMARY KEY AUTO_INCREMENT COMMENT '退款记录ID',
  `order_id` INT(11) NOT NULL COMMENT '订单ID',
  `refund_no` VARCHAR(50) NOT NULL UNIQUE COMMENT '退款单号',
  `refund_amount` DECIMAL(10, 2) NOT NULL COMMENT '退款金额',
  `reason` TEXT NOT NULL COMMENT '退款原因',
  `status` VARCHAR(20) DEFAULT 'applied' COMMENT '状态：applied-申请中，approved-已批准，rejected-已拒绝，completed-已完成',
  `apply_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '申请时间',
  `process_time` TIMESTAMP COMMENT '处理时间',
  `processed_by` INT(11) COMMENT '处理人',
  `remark` TEXT COMMENT '备注',
  INDEX idx_order_id (`order_id`),
  INDEX idx_refund_no (`refund_no`),
  INDEX idx_status (`status`),
  INDEX idx_processed_by (`processed_by`),
  FOREIGN KEY (`order_id`) REFERENCES `orders` (`order_id`) ON DELETE CASCADE,
  FOREIGN KEY (`processed_by`) REFERENCES `user` (`user_id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='退款记录表';
```

### 2.10 学习相关表

#### 2.10.1 成绩表（score）
```sql
CREATE TABLE `score` (
  `score_id` INT(11) PRIMARY KEY AUTO_INCREMENT COMMENT '成绩ID',
  `student_id` INT(11) NOT NULL COMMENT '学生ID',
  `course_id` INT(11) NOT NULL COMMENT '课程ID',
  `exam_type` VARCHAR(50) NOT NULL COMMENT '考试类型：midterm-期中，final-期末，quiz-测验，assignment-作业',
  `score_value` DECIMAL(5, 2) COMMENT '成绩分数',
  `exam_date` DATE COMMENT '考试日期',
  `remarks` TEXT COMMENT '备注',
  `created_by` INT(11) COMMENT '录入人',
  `create_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  INDEX idx_student_id (`student_id`),
  INDEX idx_course_id (`course_id`),
  INDEX idx_exam_type (`exam_type`),
  INDEX idx_exam_date (`exam_date`),
  INDEX idx_created_by (`created_by`),
  FOREIGN KEY (`student_id`) REFERENCES `student` (`student_id`) ON DELETE CASCADE,
  FOREIGN KEY (`course_id`) REFERENCES `course` (`course_id`) ON DELETE CASCADE,
  FOREIGN KEY (`created_by`) REFERENCES `user` (`user_id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='成绩表';
```

#### 2.10.2 学习进度表（learning_progress）
```sql
CREATE TABLE `learning_progress` (
  `progress_id` INT(11) PRIMARY KEY AUTO_INCREMENT COMMENT '进度ID',
  `student_id` INT(11) NOT NULL COMMENT '学生ID',
  `course_id` INT(11) NOT NULL COMMENT '课程ID',
  `completed_hours` INT(11) DEFAULT 0 COMMENT '已完成课时',
  `total_hours` INT(11) COMMENT '总课时',
  `progress_percentage` DECIMAL(5, 2) DEFAULT 0 COMMENT '进度百分比',
  `last_study_time` TIMESTAMP COMMENT '最后学习时间',
  `next_schedule_time` TIMESTAMP COMMENT '下次排课时间',
  `attendance_rate` DECIMAL(5, 2) DEFAULT 0 COMMENT '出勤率',
  `avg_score` DECIMAL(5, 2) COMMENT '平均分',
  `status` VARCHAR(20) DEFAULT 'in_progress' COMMENT '状态：in_progress-进行中，completed-已完成，paused-已暂停',
  UNIQUE KEY uk_student_course (`student_id`, `course_id`),
  INDEX idx_student_id (`student_id`),
  INDEX idx_course_id (`course_id`),
  INDEX idx_status (`status`),
  INDEX idx_next_schedule_time (`next_schedule_time`),
  INDEX idx_attendance_rate (`attendance_rate`),
  FOREIGN KEY (`student_id`) REFERENCES `student` (`student_id`) ON DELETE CASCADE,
  FOREIGN KEY (`course_id`) REFERENCES `course` (`course_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='学习进度表';
```

#### 2.10.3 作业表（assignment）
```sql
CREATE TABLE `assignment` (
  `assignment_id` INT(11) PRIMARY KEY AUTO_INCREMENT COMMENT '作业ID',
  `course_id` INT(11) NOT NULL COMMENT '课程ID',
  `title` VARCHAR(255) NOT NULL COMMENT '作业标题',
  `description` TEXT COMMENT '作业描述',
  `start_time` TIMESTAMP NOT NULL COMMENT '发布时间',
  `due_time` TIMESTAMP NOT NULL COMMENT '截止时间',
  `status` VARCHAR(20) DEFAULT 'active' COMMENT '状态：active-进行中，completed-已结束',
  `created_by` INT(11) COMMENT '发布人',
  `create_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  INDEX idx_course_id (`course_id`),
  INDEX idx_title (`title`),
  INDEX idx_status (`status`),
  INDEX idx_created_by (`created_by`),
  FOREIGN KEY (`course_id`) REFERENCES `course` (`course_id`) ON DELETE CASCADE,
  FOREIGN KEY (`created_by`) REFERENCES `user` (`user_id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='作业表';
```

#### 2.10.4 作业提交表（assignment_submission）
```sql
CREATE TABLE `assignment_submission` (
  `submission_id` INT(11) PRIMARY KEY AUTO_INCREMENT COMMENT '提交ID',
  `assignment_id` INT(11) NOT NULL COMMENT '作业ID',
  `student_id` INT(11) NOT NULL COMMENT '学生ID',
  `content` TEXT COMMENT '作业内容',
  `file_path` VARCHAR(255) COMMENT '附件路径',
  `submit_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '提交时间',
  `score` DECIMAL(5, 2) COMMENT '评分',
  `feedback` TEXT COMMENT '教师反馈',
  `graded_by` INT(11) COMMENT '评分人',
  `graded_time` TIMESTAMP COMMENT '评分时间',
  `status` VARCHAR(20) DEFAULT 'submitted' COMMENT '状态：submitted-已提交，graded-已评分，late-迟到',
  UNIQUE KEY uk_assignment_student (`assignment_id`, `student_id`),
  INDEX idx_assignment_id (`assignment_id`),
  INDEX idx_student_id (`student_id`),
  INDEX idx_status (`status`),
  INDEX idx_graded_by (`graded_by`),
  FOREIGN KEY (`assignment_id`) REFERENCES `assignment` (`assignment_id`) ON DELETE CASCADE,
  FOREIGN KEY (`student_id`) REFERENCES `student` (`student_id`) ON DELETE CASCADE,
  FOREIGN KEY (`graded_by`) REFERENCES `user` (`user_id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='作业提交表';
```

### 2.11 教学资源相关表

#### 2.11.1 教学资源表（teaching_resource）
```sql
CREATE TABLE `teaching_resource` (
  `resource_id` INT(11) PRIMARY KEY AUTO_INCREMENT COMMENT '资源ID',
  `title` VARCHAR(255) NOT NULL COMMENT '资源标题',
  `description` TEXT COMMENT '资源描述',
  `file_path` VARCHAR(255) NOT NULL COMMENT '文件路径',
  `file_size` BIGINT(20) COMMENT '文件大小（字节）',
  `file_type` VARCHAR(50) COMMENT '文件类型',
  `category` VARCHAR(100) COMMENT '资源分类',
  `course_id` INT(11) COMMENT '所属课程',
  `uploader_id` INT(11) NOT NULL COMMENT '上传者ID',
  `upload_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '上传时间',
  `download_count` INT(11) DEFAULT 0 COMMENT '下载次数',
  `status` VARCHAR(20) DEFAULT 'published' COMMENT '状态：draft-草稿，published-已发布，archived-已归档',
  INDEX idx_title (`title`),
  INDEX idx_category (`category`),
  INDEX idx_course_id (`course_id`),
  INDEX idx_uploader_id (`uploader_id`),
  INDEX idx_status (`status`),
  FOREIGN KEY (`course_id`) REFERENCES `course` (`course_id`) ON DELETE SET NULL,
  FOREIGN KEY (`uploader_id`) REFERENCES `user` (`user_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='教学资源表';
```

### 2.12 系统相关表

#### 2.12.1 公告表（announcement）
```sql
CREATE TABLE `announcement` (
  `announcement_id` INT(11) PRIMARY KEY AUTO_INCREMENT COMMENT '公告ID',
  `title` VARCHAR(255) NOT NULL COMMENT '公告标题',
  `content` TEXT NOT NULL COMMENT '公告内容',
  `type` VARCHAR(50) DEFAULT 'general' COMMENT '公告类型',
  `target_role` VARCHAR(100) COMMENT '目标角色',
  `start_time` TIMESTAMP COMMENT '开始显示时间',
  `end_time` TIMESTAMP COMMENT '结束显示时间',
  `status` VARCHAR(20) DEFAULT 'active' COMMENT '状态：active-有效，inactive-无效',
  `created_by` INT(11) COMMENT '发布人',
  `create_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  INDEX idx_title (`title`),
  INDEX idx_type (`type`),
  INDEX idx_status (`status`),
  INDEX idx_created_by (`created_by`),
  FOREIGN KEY (`created_by`) REFERENCES `user` (`user_id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='公告表';
```

#### 2.12.2 操作日志表（operation_log）
```sql
CREATE TABLE `operation_log` (
  `log_id` INT(11) PRIMARY KEY AUTO_INCREMENT COMMENT '日志ID',
  `user_id` INT(11) COMMENT '操作用户ID',
  `username` VARCHAR(50) COMMENT '用户名',
  `operation_type` VARCHAR(50) NOT NULL COMMENT '操作类型',
  `module` VARCHAR(50) NOT NULL COMMENT '操作模块',
  `action` VARCHAR(255) NOT NULL COMMENT '具体操作',
  `ip_address` VARCHAR(50) COMMENT 'IP地址',
  `user_agent` TEXT COMMENT '用户代理',
  `success` TINYINT(4) DEFAULT 1 COMMENT '是否成功：0-失败，1-成功',
  `error_message` TEXT COMMENT '错误信息',
  `create_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '操作时间',
  INDEX idx_user_id (`user_id`),
  INDEX idx_username (`username`),
  INDEX idx_operation_type (`operation_type`),
  INDEX idx_module (`module`),
  INDEX idx_create_time (`create_time`),
  INDEX idx_success (`success`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='操作日志表';
```

#### 2.12.2 系统配置表（system_config）
```sql
CREATE TABLE `system_config` (
  `config_id` INT(11) PRIMARY KEY AUTO_INCREMENT COMMENT '配置ID',
  `config_key` VARCHAR(100) NOT NULL UNIQUE COMMENT '配置键',
  `config_value` TEXT COMMENT '配置值',
  `config_type` VARCHAR(50) DEFAULT 'string' COMMENT '配置类型：string-字符串，number-数字，boolean-布尔值，json-JSON对象',
  `description` VARCHAR(255) COMMENT '配置描述',
  `status` TINYINT(4) DEFAULT 1 COMMENT '状态：0-禁用，1-启用',
  `create_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  INDEX idx_config_key (`config_key`),
  INDEX idx_status (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='系统配置表';
```

## 3. 数据库关系图

```
+---------------+     +----------------+     +------------------+
|     user      |     |     role       |     |    permission    |
+---------------+     +----------------+     +------------------+
| user_id (PK)  |     | role_id (PK)   |     | permission_id(PK)|
| username      |     | role_name      |     | permission_code  |
| password      |     | description    |     | permission_name  |
| email         |     +--------+-------+     | module           |
| phone         |              |             | operation        |
| real_name     |              |             +--------+---------+
+-------+-------+              |                      |
        |                      |                      |
        |                      |                      |
        v                      v                      v
+-------+-------+     +--------+-------+     +--------+---------+
|teacher        |     |  user_role     |     | role_permission |
+---------------+     +----------------+     +------------------+
|teacher_id(PK) |     |id              |     |id                |
|user_id (FK)   |     |user_id (FK)    |     |role_id (FK)      |
|teacher_no     |     |role_id (FK)    |     |permission_id (FK)|
|name           |     +----------------+     +------------------+
|phone          |
+-------+-------+
        |
        |
        v
+-------+-------+     +------------------+     +----------------+
|student        |     |     course       |     |     class       |
+---------------+     +------------------+     +----------------+
|student_id(PK) |     |course_id (PK)   |     |class_id (PK)    |
|user_id (FK)   |     |course_name      |     |class_name       |
|student_no     |     |description      |     |head_teacher_id(FK)
|name           |     |credit           |     |start_date       |
|phone          |     |total_hours      |     +--------+-------+
+-------+-------+     |start_date       |              |
        |             |end_date         |              |
        |             +--------+-------+              |
        |                      |                       |
        |                      |                       |
        v                      v                       v
+-------+-------+     +--------+-------+     +--------+---------+
|student_course |     |  schedule       |     |student_class    |
+---------------+     +------------------+     +----------------+
|id             |     |schedule_id (PK) |     |id               |
|student_id (FK)|     |course_id (FK)   |     |student_id (FK)  |
|course_id (FK) |     |teacher_id (FK)  |     |class_id (FK)    |
|total_hours    |     |classroom_id (FK)|     |join_date        |
|remaining_hours|     |start_time       |     +----------------+
|used_hours     |     |end_time         |              |
+-------+-------+     +--------+-------+              |
        |                      |                       |
        |                      |                       |
        v                      v                       v
+-------+-------+     +--------+-------+     +--------+---------+
|course_hours_record| |schedule_student |     |   classroom      |
+-------------------+ +------------------+     +----------------+
|record_id (PK)     | |id                |     |classroom_id (PK)|
|student_id (FK)    | |schedule_id (FK)  |     |room_no          |
|course_id (FK)     | |student_id (FK)   |     |capacity         |
|teacher_id (FK)    | |course_id (FK)    |     |location         |
|schedule_id (FK)   | +------------------+     +--------+-------+
|hours              |                      |              |
|record_type        |                      |              |
+-------+-------+     +------------------+              |
        |                      |                       |
        |                      v                       |
        |             +--------+-------+              |
        |             |  attendance     |              |
        |             +------------------+              |
        |             |attendance_id (PK)|              |
        |             |schedule_id (FK) |              |
        |             |student_id (FK)  |              |
        |             |status           |              |
        |             +--------+-------+              |
        |                      |                       |
        |                      v                       |
        |             +--------+-------+              |
        |             |  class_record   |              |
        |             +------------------+              |
        |             |class_record_id(PK)|             |
        |             |schedule_id (FK) |              |
        |             |teacher_id (FK) |              |
        |             |classroom_id (FK)|              |
        |             +--------+-------+              |
        |                      |                       |
        v                      v                       v
+-------+-------+     +--------+-------+     +--------+---------+
|student_class_archive| | deduction_rule |     |classroom_status_log|
+-------------------+ +------------------+     +----------------+
|archive_id (PK)    | |rule_id (PK)      |     |log_id (PK)     |
|student_id (FK)    | |rule_name         |     |classroom_id (FK)|
|course_id (FK)     | |rule_type         |     |schedule_id (FK)|
|schedule_id (FK)   | |deduction_ratio   |     |start_time      |
|class_record_id (FK)| +------------------+     |end_time        |
|hours_deducted     |                           +----------------+
+-------------------+                           
```

## 4. 索引设计与优化

### 4.1 索引设计原则
- 为常用查询的列创建索引
- 为外键创建索引
- 为排序和分组操作的列创建索引
- 避免在频繁更新的列上创建过多索引
- 考虑复合索引的顺序，将选择性高的列放在前面

### 4.2 关键索引列表
- 用户表：username, email, phone
- 学生表：student_no, name, phone, email
- 教师表：teacher_no, name, phone, email
- 课程表：course_name, category, status
- 班级表：class_name, head_teacher_id
- 排课表：course_id, teacher_id, classroom_id, start_time, end_time, status, schedule_type, day_of_week
- 签到表：schedule_id, student_id, attendance_time, status, attendance_type
- 排课-学生关联表：schedule_id, student_id, course_id, status
- 课时记录表：student_id, course_id, schedule_id, record_type, record_date
- 上课记录表：schedule_id, teacher_id, status, actual_start_time
- 学生上课档案表：student_id, course_id, schedule_id, class_date, attendance_status
- 订单表：order_no, student_id, status, payment_time
- 成绩表：student_id, course_id, exam_type

## 5. 数据库优化建议

### 5.1 查询优化
- 避免使用 SELECT *，只查询必要的字段
- 使用 JOIN 代替子查询
- 合理使用 LIMIT 限制返回行数
- 避免在 WHERE 子句中对字段进行函数操作
- 使用 EXPLAIN 分析查询语句执行计划

### 5.2 性能优化
- 定期分析和优化表：ANALYZE TABLE
- 定期重建索引：ALTER TABLE ... FORCE
- 合理设置缓存大小
- 考虑使用读写分离架构
- 对于大数据表，考虑分区表

### 5.3 安全优化
- 敏感数据加密存储
- 使用参数化查询防止 SQL 注入
- 最小权限原则分配数据库用户权限
- 定期备份数据
- 启用数据库审计日志

## 6. 数据库维护计划

### 6.1 定期备份
- 全量备份：每周一次
- 增量备份：每天一次
- 备份验证：定期测试备份文件的可用性

### 6.2 性能监控
- 监控慢查询日志
- 监控数据库连接数和资源使用情况
- 设置性能阈值告警

### 6.3 日常维护
- 定期清理过期数据
- 检查和修复表结构：CHECK TABLE, REPAIR TABLE
- 监控和优化表空间使用

## 7. 总结

本数据库设计基于课程管理系统的业务需求，提供了完整的数据表结构、字段定义、约束条件和表间关系。设计遵循了规范化原则，同时考虑了系统性能和扩展性需求。通过合理的索引设计和优化建议，可以确保系统在实际运行中具有良好的性能和稳定性。

随着业务的发展，数据库设计可以根据实际需求进行调整和优化，以更好地支持系统功能的扩展和性能提升。